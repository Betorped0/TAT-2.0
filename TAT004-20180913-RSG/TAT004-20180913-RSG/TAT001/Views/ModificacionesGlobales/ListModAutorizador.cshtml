@model TAT001.Models.ModificacionesGlobalesViewModel
@using TAT001.Entities
@using (Html.BeginForm("ListModAutorizador", "ModificacionesGlobales", FormMethod.Post, new { @id = "modAutorizadoForm" }))
{
    <div class="col s12 l12 right-align">
        <button type="submit" id="btn_save" class="btn btn-default" disabled></button>
    </div>
    <table class="table mdl-data-table striped" id="tableModAutorizador" style="width:100%; overflow-x: scroll;">
        <thead>
            <tr class="text-left">
                <th id="lbl_num_doc">Num Doc</th>
                <th id="lbl_usuario">Usuario</th>
                <th id="lbl_autorizador">Autorizador</th>
                <th id="lbl_nuevo_autorizador">Nuevo autorizador</th>
            </tr>
        </thead>
        <tbody>
            @{
                for (int i = 0; i < Model.solicitudPorAprobar.Count; i++)
                {
                    <tr>
                        <td>
                            @Html.HiddenFor(model => Model.solicitudPorAprobar[i].NUM_DOC)
                            @Model.solicitudPorAprobar[i].NUM_DOC
                        </td>
                        <td>
                            @Html.HiddenFor(model => Model.solicitudPorAprobar[i].USUARIOD_ID)
                            @Html.HiddenFor(model => Model.solicitudPorAprobar[i].USUARIOA_NOMBRE)
                            @Model.solicitudPorAprobar[i].USUARIOD_ID - @Model.solicitudPorAprobar[i].USUARIOA_NOMBRE
                        </td>
                        <td>
                            @Html.HiddenFor(model => Model.solicitudPorAprobar[i].USUARIOA_ID)
                            @Html.HiddenFor(model => Model.solicitudPorAprobar[i].USUARIOA_NOMBRE)
                            @Model.solicitudPorAprobar[i].USUARIOA_ID - @Model.solicitudPorAprobar[i].USUARIOA_NOMBRE
                        </td>
                        <td>
                            @if (i == 0)
                            {
                                @Html.EditorFor(model => Model.solicitudPorAprobar[i].USUARIOA_ID_NUEVO, new { htmlAttributes = new { @style = "width: 250px;", @maxlength = 18, @id = "USUARIOA_ID_NUEVO" } })
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
    <div>

        @if (ViewBag.textos != null)
        {
            foreach (TEXTO t in ViewBag.textos)
            {
                <script>
                try {
                    var elem = document.getElementById("@t.CAMPO_ID");
                    if (elem.nodeName != 'INPUT' & elem.nodeName != 'SELECT' & elem.nodeName != 'TABLE' & elem.nodeName != 'TEXTAREA')
                    elem.innerHTML = "@t.TEXTOS";
                } catch (e) {
                    try {
                        var divs = document.getElementsByClassName("@t.CAMPO_ID");
                        [].slice.call(divs).forEach(function (div) {
                            if (div.nodeName != 'INPUT' & div.nodeName != 'SELECT' & div.nodeName != 'TABLE' & div.nodeName != 'TEXTAREA')
                            div.innerHTML = "@t.TEXTOS";
                        });
                    }
                    catch (ee) {

                    }
                 }
                </script>
            }
        }
    </div>
}
<script>
    var registros = "@Model.solicitudPorAprobar.Count"*1;

    //----- Configuracion de Tablas-----
        var root = "@Url.Content("~")",
        spras_id = "@ViewBag.spras_id",
        urlLanguage = root + "Scripts/lang/" + spras_id + ".json";
        fnCommon.configurarTable('tableModAutorizador', '50vh', '50vh', urlLanguage, 'cmbPagModAutorizador','gfilterModAutorizador',[0]);
        if (registros > 0) {
            $('#btn_save').removeAttr('disabled');
        }
    //-------Mostrar process---------
    $('#modAutorizadoForm').submit(function () {
        $("#USUARIOA_ID_2").removeClass("invalid");
        var esCambio = $("#USUARIOA_ID_NUEVO").val() != "";
        if (registros > 0 && esCambio) {
            document.getElementById("loader").style.display = "flex";
        } else if (!esCambio) {
            $("#USUARIOA_ID_2").addClass("invalid");
            return;
        } else {
            return;
        }

    });

</script>
<script>
    
</script>
<script>
    auto(document).ready(function () {
        $("#USUARIOA_ID_NUEVO").autocomplete({
                source: function (request, response) {
                    var sociedad_id = $("#SOCIEDAD_ID_2").val();
                    fnCommon.autoAjax(root + "Listas/Usuarios", response, { Prefix: request.term, autorizador: 2, sociedad_id: sociedad_id }, function (item) { return { label: (item.ID + " - " + item.NOMBRE + " " + item.APELLIDO_P + " " + (item.APELLIDO_M == null ? "" : item.APELLIDO_M)), value: item.ID }; });
                },
                messages: {
                    noResults: '',
                    results: function (resultsCount) { }
                },
                select: function (event, ui) {
                    var label = ui.item.label;
                    var value = ui.item.value;
                }
            });
    })
    
</script>