@model TAT001.Models.DocumentoFlujo
@using TAT001.Entities
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.pagina_r = 201;
    ViewBag.carpeta_r = 200;
    List<TAT001.Entities.CARTAP>
    lstCarta = ViewBag.cartap as List<TAT001.Entities.CARTAP>;
    var pos = lstCarta.GroupBy(c => c.POS_ID).Select(g => g.First()).ToList();
    int idn = 0;//LEJ 12.07.18
}
<script>
    var root = "@Url.Content("~")";
</script>
@try
{

    <link t href="~/Content/dropdowntree.css" rel="stylesheet" />
    <script src="~/Scripts/dropdowntree.js"></script>
    <script src="~/Scripts/formatos.js"></script>
    <script src="~/Scripts/materialize2.js"></script>
    <input id="miles" name="miles" type="hidden" value="@ViewBag.miles">//LEJ 09.07.18
    <input id="dec" name="dec" type="hidden" value="@ViewBag.dec">//LEJ 09.07.18
    <style>
        #lbl_sap {
            font-size: 12px !important;
        }

        #txt_notas {
            min-height: 90px;
        }
    </style>
    <div class="row" style="margin-bottom:0">
        @* ---DRS 3.10.2018--- *@
        <div class="col s12 m7">
            <div class="row" style="margin-bottom:0">
                @* ---DRS 3.10.2018--- *@
                <div class="input-field col s2">
                    @Html.EditorFor(model => model.D.USUARIOC_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIOC_ID, new { @id = "lbl_userid" })
                </div>
                @* ---DRS 3.10.2018--- *@
                <div class="input-field col s2">
                    @{ string manager = Model.D.CLIENTE.CLIENTEFs.Any(x => x.ACTIVO) ? Model.D.CLIENTE.CLIENTEFs.First(x => x.ACTIVO).USUARIO1_ID : "";
                        @Html.EditorFor(model => model.D.USUARIO.MANAGER, new { htmlAttributes = new { @disabled = "disabled", @Value = manager } })
                        @Html.LabelFor(model => model.D.USUARIO.MANAGER, "Manager", new { @id = "lbl_manager" })
                    }
                </div>
                @* ---DRS 3.10.2018--- *@
                <div class="input-field col s2">
                    @Html.EditorFor(model => model.D.USUARIO.BACKUP_ID, "BACKUP", new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIO.BACKUP_ID, "Backup", new { @id = "lbl_backup" })
                </div>
                @* ---DRS 3.10.2018--- *@
                <div class="input-field col s2">
                    @Html.EditorFor(model => model.D.USUARIO.BUNIT, "BU", new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIO.BUNIT, "BU", new { @class = "lbl_bu" })
                </div>
                @* ---DRS 3.10.2018--- *@
                <div class="input-field col s4">
                    @if (Model.D.ESTATUS == "N" | Model.D.ESTATUS != "N")
                    {
                        TAT001.Services.Estatus es = new TAT001.Services.Estatus();//ADD RSG 25.10.2018
                        string status = es.getText(Model.D);//ADD RSG 25.10.2018
                        <input type="text" id="txt_status" value="@status" disabled="disabled" />@*//ADD RSG 25.10.2018*@
                        <label for="txt_status" id="lbl_status">Estatus</label>
                    }
                </div>
            </div>
        </div>


        @* ---DRS 13.10.2018--- *@
        <div class="col s12 m5">
            <div class="row right">
                @if (Model.D.ESTATUS_C != "C")
                {
                    if (ViewBag.acciones != null)
                    {
                        if (ViewBag.accion == "A" | ViewBag.accion == "R")
                        {
                            @*<button type="button" class="btn-small  " id="btn_workf">Acciones</button>*@
                            <div class="fixed-action-btn" id="lbl_wf">
                                <a class="btn-floating btn-large blue">
                                    <i class="large material-icons">work</i>
                                </a>
                                <ul>
                                    <li><a id="lbl_wfa" class="btn-floating green modal-trigger" href="#modal1" onclick="aprobar()"><i class="material-icons">check</i></a></li>
                                    <li><a id="lbl_wfr" class="btn-floating red modal-trigger" href="#modal1" onclick="rechazar()"><i class="material-icons">close</i></a></li>
                                </ul>
                            </div>
                            <script>

                                var elem = document.querySelector('.fixed-action-btn');
                                var options = {
                                    direction: 'left',
                                    hoverEnabled: false,
                                    toolbarEnabled: false
                                };
                                var instance = M.FloatingActionButton.init(elem, options);
                            </script>
                            @*<a id="lbl_wfa" class="btn-small  " href="@Url.Action(" Procesa", "Flujos" , new { id=Model.D.NUM_DOC, accion="A" })">Aprobar</a>
                    <a id="lbl_wfr" class="btn-small  " href="@Url.Action(" Procesa", "Flujos" , new { id=Model.D.NUM_DOC, accion="R" })">Rechazar</a>*@
                            <a class="btn-small modal-trigger" href="#modal1" onclick="aprobar()">Aprobar</a>
                            <a class="btn-small modal-trigger" href="#modal1" onclick="rechazar()">Rechazar</a>
                        }
                        else if (ViewBag.accion == "N" | ViewBag.accion == "M")
                        {
                            <div class="fixed-action-btn" id="lbl_wf">
                                <a class="btn-floating btn-large blue">
                                    <i class="large material-icons">work</i>
                                </a>
                                <ul>
                                    <li>@*<a id="lbl_wfn" class="btn-floating yellow darken-1 modal-trigger" href="#modal1" onclick="siguiente()"><i class="material-icons">play_arrow</i></a>*@</li>
                                    <li><a data-form-method="post" id="lbl_wfn" class="btn-floating yellow darken-1 @*modal-trigger*@" href="@Url.Action("Edit", "Solicitudes", new { id_d = Model.D.NUM_DOC })"><i class="material-icons">edit</i></a></li>
                                </ul>
                            </div>
                            <script>

                                var elem = document.querySelector('.fixed-action-btn');
                                var options = {
                                    direction: 'left',
                                    hoverEnabled: false,
                                    toolbarEnabled: false
                                };
                                var instance = M.FloatingActionButton.init(elem, options);
                            </script>
                            @*<a id="lbl_wfn" class="btn-small  " href="@Url.Action(" Procesa", "Flujos" , new { id=Model.D.NUM_DOC, accion="N" })">Siguiente</a>*@
                            @*<a id="lbl_wfn" class="btn-small modal-trigger" href="#modal1" onclick="siguiente()">Siguiente</a>*@
                            <a data-form-method="post" id="lbl_wfn" class="btn-small " href="@Url.Action("Edit", "Solicitudes", new { id_d = Model.D.NUM_DOC })">Editar</a> @*OCG 09-10-18 Se corrige error en la ruta*@
                        }
                        else if (ViewBag.accion == "P")
                        {

                            <div class="fixed-action-btn" id="lbl_wf">
                                <a class="btn-floating btn-large blue">
                                    <i class="large material-icons">work</i>
                                </a>
                                <ul>
                                    <li><a id="lbl_wfn" class="btn-floating yellow darken-1 " href="#modal1" onclick="contabilizar()"><i class="material-icons">send</i></a></li> @*OCG 09-10-18 Se corrige error en la ruta*@
                                </ul>
                            </div>
                            <script>

                                var elem = document.querySelector('.fixed-action-btn');
                                var options = {
                                    direction: 'left',
                                    hoverEnabled: false,
                                    toolbarEnabled: false
                                };
                                var instance = M.FloatingActionButton.init(elem, options);
                            </script>
                            @*<a id="lbl_wfn" class="btn-small  " href="@Url.Action(" Procesa", "Flujos" , new { id=Model.D.NUM_DOC, accion="N" })">Siguiente</a>*@
                            <a id="lbl_wfn" class="btn-small modal-trigger" href="#modal1" onclick="contabilizar()">Contabilizar</a>
                        }
                        else if (!Model.D.ESTATUS.Equals("A") & !Model.D.ESTATUS.Equals("R"))//RSG 20181002
                        {
                            if (Model.D.USUARIOC_ID == ViewBag.usuario.ID)
                            {
                                <a class="btn-small modal-trigger" id="btn_cancel" href="#modal2"></a>
                                <div id="modal2" class="modal">
                                    <div class="modal-content">
                                        <div class="row">
                                            <h4 id="txt_can"></h4>
                                            <br />
                                        </div>
                                        <div class="row" style="">
                                            <div class="col s12 m12 l12">
                                                <div class="row" style="margin-bottom:0">
                                                    <span id="span_confcancelacion"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer right">
                                        <a href="#!" class="modal-action modal-close btn-flat" id="btn_no"></a>
                                        <a class="modal-action btn-flat" id="btn_si" href="@Url.Action("Cancelar", "Solicitudes", new { id = Model.D.NUM_DOC })"></a>
                                    </div>
                                </div>
                            }
                        }
                    }
                    else if ((Model.D.ESTATUS.Equals("A") | Model.D.ESTATUS.Equals("R")) && (Model.D.TSOL.PADRE) /*&& Model.D.DOCUMENTORECs.Count < 1 && Model.D.DOCUMENTOLs.Count < 1*/)//RSG 20181002
                    {
                        if (Model.D.USUARIOC_ID == ViewBag.usuario.ID & (Model.D.DOCUMENTO_SAP != null && Model.D.DOCUMENTO_SAP != "0"))
                        {
                            <div id="div_drop" class="col">
                                <a href="@Url.Action("Create", "Solicitudes", new { id_d = Model.D.NUM_DOC.ToString(), tsol = "CPR" })" class="btn-small">Reversar</a>
                                @*<button type="button" class="btn-small  " id="btn_cancel">Cancelar</button>*@
                                <button type="button" class="btn-small dropdown-trigger">Crear solicitud relacionada</button>
                                <div id="list_rela" class="dropdowntree"></div>
                            </div>
                            <script>
                                 $('#list_rela').kendoTreeView({
                                     link: '@Url.Content("~")Solicitudes/Create?id_d=@Model.D.NUM_DOC.ToString()&tsol={val}',
                                    dataSource:@Html.Raw(Json.Encode(ViewBag.TSOL_RELA))
                                  });
                            </script>

                        }
                        if (ViewBag.usuario.PUESTO_ID == 8 & Model.D.DOCUMENTOLs.Count > 0)
                        {
                            <div id="div_drop" class="col">
                                <a href="@Url.Action("Backorder", "Recurrencias", new { id_d = Model.D.NUM_DOC.ToString() })" class="btn-small">Backorder</a>
                            </div>
                        }
                    }
                    else if (!Model.D.ESTATUS.Equals("A"))
                    {
                        if (Model.D.USUARIOC_ID == ViewBag.usuario.ID)
                        {
                            <a class="btn-small modal-trigger" id="btn_cancel" href="#modal3"></a>
                            <div id="modal3" class="modal">
                                <div class="modal-content">
                                    <div class="row">
                                        <h4 id="txt_can"></h4>
                                        <br />
                                    </div>
                                    <div class="row" style="">
                                        <div class="col s12 m12 l12">
                                            <div class="row" style="margin-bottom:0">
                                                <span id="span_confcancelacion"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer right">
                                    <a href="#!" class="modal-action modal-close btn-flat">No</a>
                                    <a class="modal-action btn-flat" href="@Url.Action(" Cancelar", "Solicitudes", new { id = Model.D.NUM_DOC })">Si</a>
                                </div>
                            </div>
                            <script>
                                var elem3 = document.getElementById('modal3');
                                if (elem3 != undefined)
                                    M.Modal.init(elem3, []);
                            </script>
                        }
                        if (Model.D.ESTATUS_WF == "B")//ADD RSG 30.10.2018
                        {
                            <a class="btn-small" id="lbl_wfn" href="@Url.Action("Edit", "Solicitudes", new { id_d = Model.D.NUM_DOC })">Editar</a>
                        }
                    }
                    @*//else
                        //{*@
                if (Model.D.TSOL.CARTA)
                {
                        @* ---DRS 13.10.2018--- *@
                        <div class="col">
                            <button type="button" class="btn-small" data-target="list_carta" style="width:100%;" id="btn_carta">Carta</button>
                        </div>
                        @*<button type="button" class="btn-small  " id="btn_cancel">Cancelar</button>*@
                        <ul id='list_carta' class='dropdown-content'>
                            @*

                                <li><a href="@Url.Action(" Index", "CartaF" , new { id=Model.D.NUM_DOC })" id="lbl_list">Lista de cartas</a></li>*@ @*//B20180720P MGC Guardar Carta*@
                                @* ---DRS 14.10.2018--- *@
                                <li><a href="@Url.Action("Lista", "CartaV", new { id = Model.D.NUM_DOC, swf = Model.D.ESTATUS_WF })" id="lbl_list">Lista de cartas</a></li> @*//B20180720P MGC Guardar Carta*@
                                @if (Model.D.ESTATUS_WF.Equals("S"))
                                {
                                    <li><a href="@Url.Action("Create", "CartaV", new { id = Model.D.NUM_DOC })" id="lbl_genc">Generar carta</a></li>
                                }
                                else if (Model.D.ESTATUS_WF.Equals("F") || Model.D.ESTATUS_WF.Equals("S") || Model.D.ESTATUS_WF.Equals("R"))
                                {
                                    <li><a href="@Url.Action("Create", "CartaD", new { id = Model.D.NUM_DOC })" id="lbl_genc">Imprimir</a></li>
                                }
                                else
                                {
                                    <li><a href="@Url.Action("Create", "CartaD", new { id = Model.D.NUM_DOC })" id="lbl_genc">Imprimir draft</a></li>
                                }
                            </ul>
                            <script>
                                var elem = document.getElementById('btn_carta');
                                var options = {
                                    constrainWidth: false
                                    //,hover: true
                                };
                                var instance = M.Dropdown.init(elem, options);
                            </script>
                }
                        @* } *@
                }
            </div>
        </div>
    </div>

    <div class="">
        <div class="row">
            <div class="col s12">
                <ul class="tabs" id="tab">
                    <li class="tab col s2"><a href="#info" id="tab_info">Información</a></li>
                    @*
                        <li class="tab col s2"><a href="#temp" id="lbl_temp">Temporalidad</a></li>*@<!--RSG 09.07.2018 DEL-->
                    @if (ViewBag.acciones != null & ViewBag.accion == "S")
                    {
                        <li class="tab col s2"><a href="#supp" id="tab_soporte" class="active">Soporte</a></li>
                    }
                    else
                    {
                        <li class="tab col s2"><a href="#supp" id="tab_soporte">Soporte</a></li>
                    }
                    <li class="tab col s2"><a href="#dist" id="tab_dis">Distribución</a></li>
                    @if (Model.D.DOCUMENTORECs.Count > 0)
                    {
                        <li class="tab col s2"><a href="#recu" id="tab_dis">Recurrencia</a></li><!--RSG 09.07.2018 ADD-->
                    }
                    @if (ViewBag.acciones != null & ViewBag.accion == "T")
                    {
                        <li class="tab col s2"><a href="#fina" id="tab_fin" class="active">Financiera</a></li>
                    }
                    else
                    {
                        <li class="tab col s2"><a href="#fina" id="tab_fin">Financiera</a></li>
                    }
                </ul>
            </div>
            @*///////////////////////////////CAMBIOS LGPP INICIO//////////////////////////*@
            <div id="info" class="col s12" style="font-size:12px;">
                <div class="row">
                    <div class="col s12 m6 l6">
                        @if (Model.D.DOCUMENTO_REF != null)
                        {
                            <div class="card-panel">
                                <div class="row" style="margin-bottom:0">
                                    <div class="input-field col s8">
                                        <input type="text" value="@Model.D.DOCUMENTO_REF" disabled="disabled" />
                                        <label for="D_DOCUMENTO_REF" id="lbl_provision"></label>
                                    </div>
                                    <div class="col s4 right-align">
                                        <a href="@Url.Action("Details", new { id = Model.D.DOCUMENTO_REF })" class="btn-small  ">Ver</a>
                                    </div>
                                </div>
                            </div>
                        }
                        <div class="card-panel">
                            <h5 id="head_solclas">Tipo de solicitud y Clasificación</h5>
                            <div class="row" style="margin-bottom:0">
                                <div class="input-field col s12">
                                    @Html.EditorFor(model => model.D.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(model.D.USUARIO.SPRAS_ID)).FirstOrDefault().TXT50, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.TSOL, "Tipo de solicitud", new { @class = "lbl_tiposol" })
                                </div>
                                <div class="input-field col s12">
                                    @Html.EditorFor(model => model.D.GALL.GALLTs.Where(a => a.SPRAS_ID.Equals(model.D.USUARIO.SPRAS_ID)).FirstOrDefault().TXT50, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.GALL_ID, "Clasificación", new { @id = "lbl_tall" })
                                </div>
                                @Html.HiddenFor(model => model.D.GALL_ID, new { @id = "gall_id" })
                                @Html.HiddenFor(model => model.D.TALL_ID, new { @id = "tall_id" })
                                @*--------- DRS 24.09.18-------------- *@
                                @if (ViewBag.nombreC != null)
                                {
                                    foreach (var cuenta in ViewBag.nombreC)
                                    {
                                        <input id="cuentaNombre" type="hidden" value="@cuenta">
                                    }
                                }
                                else
                                {
                                    <input id="cuentaNombre" type="hidden" value="">
                                }
                                @*--------- DRS 24.09.18-------------- *@
                                @if (ViewBag.nombreC2 != null)
                                {
                                    foreach (var cuenta2 in ViewBag.nombreC2)
                                    {
                                        <input id="cuentaNombre2" type="hidden" value="@cuenta2">
                                    }
                                }
                                else
                                {
                                    <input id="cuentaNombre2" type="hidden" value="">
                                }
                                @Html.HiddenFor(model => model.D.MONTO_DOC_MD, new { @id = "monto_dis" })
                            </div>
                        </div>
                        <div class="card-panel">
                            <h5 id="head_datospais">Datos país</h5>
                            <div class="row" style="margin-bottom:0">
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.SOCIEDAD_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.SOCIEDAD, "Sociedad", new { @id = "lbl_sociedad" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.PAI.LANDX, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.PAI.LANDX, "País", new { @id = "lbl_paiss" })
                                </div>
                            </div>
                            <div class="row" style="margin-bottom:0">
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.PAI.LANDX, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.PAI.LANDX, "Subregión", new { @id = "lbl_region" })
                                </div>
                            </div>
                            <div class="row" style="margin-bottom:0">
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.ESTADO, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.ESTADO, "Estado", new { @id = "lbl_estado" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.CIUDAD, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.CIUDAD, "Ciudad", new { @id = "lbl_ciudad" })
                                </div>
                            </div>
                        </div>
                        @*<div class="row" style="margin-bottom:0">
                        *@
                        <div class="card-panel">
                            <div class="row" style="margin-bottom:0">
                                <h5 id="head_geninfo">Información general</h5>
                                <div class="input-field col s12">
                                    @*@Html.EditorFor(model => model.D.FECHAC, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })*@
                                    <input type="text" disabled="disabled" value="@Model.D.FECHAC.Value.ToShortDateString()" />
                                    @Html.LabelFor(model => model.D.FECHAC, "Fecha", new { @id = "lbl_fechad" })
                                </div>
                                <div class="input-field col s6 l6">
                                    @Html.EditorFor(model => model.D.PERIODO, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                    @Html.LabelFor(model => model.D.PERIODO, "Periodo", new { @class = "lbl_periodo" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.EJERCICIO, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                    @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio", new { @class = "lbl_ejercicio" })
                                </div>
                                <div class="input-field col s12">
                                    @Html.EditorFor(model => model.D.CONCEPTO, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.CONCEPTO, "Concepto", new { @id = "lbl_concepto" })
                                </div>
                                <div class="input-field col s12">
                                    @Html.TextAreaFor(model => model.D.NOTAS, new { @id = "txt_notas", @class = "materialize-textarea", @disabled = "disabled" })
                                    @Html.LabelFor(model => model.D.NOTAS, "Mecánica de negociación", new { @id = "lbl_notas" })
                                </div>
                            </div>
                        </div>
                        @*
                            </div>*@
                        @if (Model.D.DOCUMENTOF != null & !Model.D.TSOL.PADRE & !Model.D.TSOL.REVERSO)
                        {
                            if (Model.D.DOCUMENTOF.Count > 0)
                            {
                                <div class="card-panel">
                                    <h5 id="head_reffact">Facturas</h5>
                                    <div class="row" style="margin-bottom:0">
                                        <div class="col s12">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        @if (Model.D.DOCUMENTOF[0].FACTURA != "0")
                                                        {
                                                            <th id="thead_fact">No. Factura Fiscal</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].FECHA != null)
                                                        {
                                                            <th id="thead_fecha">Fecha Factura</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].PROVEEDOR != "0         ")
                                                        {
                                                            <th id="thead_provdesc">Proveedor Desc</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].CONTROL != "0")
                                                        {
                                                            <th id="thead_control">Control</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].AUTORIZACION != "0")
                                                        {
                                                            <th id="thead_aut">Autorización</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].VENCIMIENTO != null)
                                                        {
                                                            <th id="thead_ven">Vencimiento</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].FACTURAK != "0")
                                                        {
                                                            <th id="thead_factk">Factura k</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].EJERCICIOK != "0")
                                                        {
                                                            <th id="thead_ejercicio">Año</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].BILL_DOC != null)
                                                        {
                                                            if (Model.D.DOCUMENTOF[0].BILL_DOC.Trim() != "0")
                                                            {
                                                                <th id="thead_fact">Billing</th> @*B20180801 MGC Textos*@
                                                            }
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].BELNR.Trim() != "0")
                                                        {
                                                            <th id="thead_belnr">Folio</th> @*B20180801 MGC Textos*@
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].PAYER != null)
                                                        {
                                                            if (Model.D.DOCUMENTOF[0].PAYER.Trim() != "0")
                                                            {
                                                                <th id="thead_payer">Payer</th> @*B20180801 MGC Textos*@@*@18-07-2018 jemo *@
                                                            }
                                                            if (Model.D.DOCUMENTOF[0].PAYER.Trim() != "0")
                                                            {
                                                                <th id="thead_desc">Customer</th> @*B20180801 MGC Textos*@@*@18-07-2018 jemo *@
                                                            }
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].IMPORTE_FAC != null & Model.D.DOCUMENTOF[0].IMPORTE_FAC > 0)
                                                        {
                                                            <th id="thead_importe">Importe por Factura</th> @*B20180801 MGC Textos*@@*@18-07-2018 jemo *@
                                                        }
                                                    </tr>
                                                </thead>
                                                @using (TAT001Entities db = new TAT001Entities())
                                                {
                                                    foreach (var item in Model.D.DOCUMENTOF)
                                                    {
                                                        <tr>
                                                            @if (item.FACTURA != "0")
                                                            {
                                                                <td>@item.FACTURA</td>
                                                            }
                                                            @if (item.FECHA != null)
                                                            {
                                                                string fech = item.FECHA.ToString();
                                                                fech = fech.Substring(0, 10);
                                                                <td>@fech</td>
                                                            }
                                                            @if (item.PROVEEDOR.Trim() != "0")
                                                            {
                                                                <td>@item.PROVEEDOR</td>
                                                            }
                                                            @if (item.CONTROL != "0")
                                                            {
                                                                <td>@item.CONTROL</td>
                                                            }
                                                            @if (item.AUTORIZACION != "0")
                                                            {
                                                                <td>@item.AUTORIZACION</td>
                                                            }
                                                            @if (item.VENCIMIENTO != null)
                                                            {
                                                                string venc = item.VENCIMIENTO.ToString();
                                                                venc = venc.Substring(0, 10);
                                                                <td>@venc</td>
                                                            }
                                                            @if (item.FACTURAK != "0")
                                                            {
                                                                <td>@item.FACTURAK</td>
                                                            }
                                                            @if (item.EJERCICIOK != "0")
                                                            {
                                                                <td>@item.EJERCICIOK</td>
                                                            }
                                                            @if (item.BILL_DOC != null)
                                                            {
                                                                if (item.BILL_DOC.Trim() != "0")
                                                                {
                                                                    <td>@item.BILL_DOC</td>
                                                                }
                                                            }
                                                            @if (item.BELNR.Trim() != "0")
                                                            {
                                                                <td>@item.BELNR</td>
                                                            }
                                                            @if (item.PAYER != null)
                                                            {
                                                                if (item.PAYER.Trim() != "0")
                                                                {
                                                                    <td>@item.PAYER</td>
                                                                }
                                                                if (item.PAYER.Trim() != "0")
                                                                {
                                                                    <td>@db.CLIENTEs.Where(x => x.KUNNR == item.PAYER.Trim()).Select(x => x.NAME1).FirstOrDefault()</td>
                                                                }
                                                            }
                                                            @if (Model.D.DOCUMENTOF[0].IMPORTE_FAC != null & Model.D.DOCUMENTOF[0].IMPORTE_FAC > 0)
                                                            {
                                                                decimal asd = Convert.ToDecimal(item.IMPORTE_FAC);
                                                                string impFac = asd.ToString("N2");
                                                                //double impFac2 = Convert.ToDouble(impFac);
                                                                <td>$@impFac</td>
                                                            }
                                                        </tr>
                                                    }
                                                }
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                    <div class="col s12 m6 l6">
                        <div class="row" style="margin-bottom:0">
                            <div class="card-panel">
                                <h5 id="head_infocli">Información del cliente</h5>
                                <div class="row" style="margin-bottom:0">
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.CLIENTE.KUNNR, new { htmlAttributes = new { @disabled = "disabled", @id = "payer_id" } })
                                        @Html.LabelFor(model => model.D.CLIENTE.KUNNR, "Cliente", new { @id = "lbl_payer" })
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.CLIENTE.NAME1, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.CLIENTE.NAME1, "Nombre", new { @id = "lbl_nombrecli" })
                                    </div>
                                    <div class="input-field col s12">
                                        @{
                                            string spras_id = ViewBag.spras_id;
                                            @Html.EditorFor(model => model.D.CLIENTE.TCLIENTE.TCLIENTETs.Where(x => x.SPRAS == spras_id).FirstOrDefault().TXT50, new { htmlAttributes = new { @disabled = "disabled" } })
                                            @Html.LabelFor(model => model.D.CLIENTE.TCLIENTE.TCLIENTETs.Where(x => x.SPRAS == spras_id).FirstOrDefault().TXT50, "Tipo de cliente", new { @id = "lbl_parvwcli" })
                                        }
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.VKORG, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.VKORG, "Razón social", new { @id = "lbl_vkorg" })
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.CLIENTE.STCD1, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.CLIENTE.STCD1, "Taxid", new { @id = "lbl_stcd1" })
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.CLIENTE.CANAL, new { htmlAttributes = new { @disabled = "disabled", @id = "vtweg" } })
                                        @Html.LabelFor(model => model.D.CLIENTE.CANAL, "Canal", new { @id = "lbl_stcd1" })
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.PAYER_NOMBRE, new { htmlAttributes = new { @disabled = "disabled", @id = "payer_nombre" } })
                                        @Html.LabelFor(model => model.D.PAYER_NOMBRE, "Nombre del contacto", htmlAttributes: new { @id = "lbl_payernom" })
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.PAYER_EMAIL, new { htmlAttributes = new { @disabled = "disabled", @id = "payer_email", @type = "email" } })
                                        @Html.LabelFor(model => model.D.PAYER_EMAIL, "Email de contacto", htmlAttributes: new { @id = "lbl_payeremail" })
                                    </div>
                                </div>
                            </div>
                            @{ 
                                string fechai = "", fechaf = "";
                                if (Model.D.FECHAI_VIG != null) {
                                    fechai = Model.D.FECHAI_VIG.Value.ToShortDateString();
                                }
                                if (Model.D.FECHAI_VIG != null) {
                                    fechaf = Model.D.FECHAF_VIG.Value.ToShortDateString();
                                }
                            }

                            <div class="card-panel">
                                <div class="row" style="margin-bottom:0">
                                    <h5 id="head_vigencia">Vigencia</h5>
                                    <div class="input-field col s12">
                                        @*@Html.EditorFor(model => model.D.FECHAI_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text", @value=Model.D.FECHAI_VIG.Value.ToShortDateString() } })*@
                                        <input type="text" value="@fechai" disabled="disabled" />
                                        @Html.LabelFor(model => model.D.FECHAI_VIG, "De", new { @id = "lbl_fechade" })
                                    </div>
                                    <div class="input-field col s12">
                                        @*@Html.EditorFor(model => model.D.FECHAF_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })*@
                                        <input type="text" value="@fechaf" disabled="disabled" />
                                        @Html.LabelFor(model => model.D.FECHAF_VIG, "A", new { @id = "lbl_fechahasta" })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @*///////////////////////////////CAMBIOS LGPP FIN//////////////////////////*@
            @*<div id="temp" class="col s12">
            *@
            @if (Model.D.DOCUMENTORECs.Count > 0)
            {
                <div id="recu" class="col s12">
                    <div class="row">
                        @*<div class="col s12 m12 l12">
                            <div class="card-panel">
                            <div class="row" style="margin-bottom:0">
                            <h5>Vigencia</h5>
                            <div class="input-field col s6">
                            @Html.EditorFor(model => model.D.FECHAI_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                            @Html.LabelFor(model => model.D.FECHAI_VIG, "De", new { @id = "lbl_fechai" })
                            </div>
                            <div class="input-field col s6">
                            @Html.EditorFor(model => model.D.FECHAF_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                            @Html.LabelFor(model => model.D.FECHAF_VIG, "A", new { @id = "lbl_fechaf" })
                            </div>
                            </div>
                            </div>
                            </div>*@
                        @*///////////////////////////////CAMBIOS LGPP INICIO//////////////////////////*@
                        @if (Model.D.DOCUMENTORECs.Count() > 0)
                        {
                            List<DOCUMENTO> ttol = new List<DOCUMENTO>();
                            foreach (DOCUMENTO tol in ViewBag.recs)
                            {
                                ttol.Add(tol);
                            }
                            List<DOCUMENTO> rtol = new List<DOCUMENTO>();
                            foreach (DOCUMENTO tol in ViewBag.recls)
                            {
                                rtol.Add(tol);
                            }

                            <div class="col s12 m12 l12" style="font-size:12px;">
                                <div class="card-panel">
                                    <div class="row">
                                        <h5>Recurrencia</h5>
                                    </div>
                                    @{ var caso = Model.D.TIPO_RECURRENTE; }

                                    <div class="row" style="overflow:auto;">
                                        <div class="col s12">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th id="lbl_rec_pos">Pos</th>
                                                        <th id="lbl_rec_periodo">Periodo</th>
                                                        <th id="lbl_rec_tipo">Tipo</th>
                                                        <th id="lbl_rec_numsol">No solicitud TAT</th>
                                                        <th id="lbl_rec_fecha">Fecha</th>
                                                        @if (caso != "1")
                                                        {
                                                            <th id="lbl_rec_porc">%</th>
                                                        }
                                                        <th id="lbl_rec_obj">Objetivo</th>
                                                        <th id="lbl_rec_estatus">Estatus</th>

                                                        @if (ViewBag.recs.Count > 0)
                                                        {
                                                            <th id="lbl_rec_venta">Venta del periodo</th>
                                                            if (Model.D.DOCUMENTORECs.Count > 1)
                                                            {
                                                                <th id="lbl_rec_montoprov">Monto provisión</th>
                                                            }
                                                            else
                                                            {
                                                                <th id="lbl_rec_monto_sol">Monto de solicitud</th>
                                                            }
                                                            if (Model.D.DOCUMENTORECs.Count > 1)
                                                            {
                                                                if (Model.D.PAI.BACKORDER)
                                                                {
                                                                    <th id="lbl_rec_backorder">BackOrder</th>
                                                                    <th id="lbl_rec_ventareal">Venta real</th>
                                                                }
                                                                <th id="lbl_rec_ncreverso">NC o Reverso</th>
                                                                <th id="lbl_rec_monto">Monto</th>
                                                            }
                                                        }
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var iteem in Model.D.DOCUMENTORECs)
                                                    {
                                                        @*<tr id="rec-@iteem.POS" onclick="muestraRan(this.id);">*@
                                                        <tr id="rec-@iteem.POS">
                                                            <td>@iteem.POS/@Model.D.DOCUMENTORECs.Count()</td>
                                                            @{ string periodo = "P" + iteem.PERIODO + "-" + iteem.EJERCICIO; }
                                                            <td>@periodo</td>
                                                            <td>@Model.D.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(ViewBag.spras_id)).FirstOrDefault().TXT50</td>
                                                            @if (iteem.DOC_REF > 0)
                                                            {
                                                                <td><a href="@Url.Action("Details", new { id = iteem.DOC_REF })">@iteem.DOC_REF</a></td>
                                                            }
                                                            else
                                                            {
                                                                <td>No generado</td>
                                                            }
                                                            @if (iteem.ESTATUS != "C" & iteem.ESTATUS != "P")
                                                            {
                                                                <td>No generado</td>
                                                            }
                                                            else
                                                            {
                                                                <td>@iteem.FECHAV.Value.ToShortDateString()</td>}

                                                            @*@if (!(ViewBag.recs.Count > 0 & iteem.DOC_REF != null & iteem.DOC_REF != 0))
                                                                {*@
                                                            @if (Model.D.LIGADA == true)
                                                            {
                                                                if (iteem.DOCUMENTORANs.Count > 0)
                                                                {
                                                                    foreach (TAT001.Entities.DOCUMENTORAN ran in iteem.DOCUMENTORANs.Where(x => x.LIN == 1))//RSG 20.09.2018
                                                                    {
                                                                        if (caso != "1")
                                                                        {
                                                                            <td class="porcentaje">@ran.PORCENTAJE</td>}
                                                                        <td class="precio">@ran.OBJETIVOI</td>
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    if (caso != "1")
                                                                    {
                                                                        <td class="porcentaje">@iteem.PORC</td>}
                                                                    <td class="precio">@iteem.MONTO_BASE</td>
                                                                }
                                                            }
                                                            else
                                                            {
                                                                if (caso != "1")
                                                                {
                                                                    <td class="porcentaje">@Math.Round(iteem.PORC.Value, 2)</td>
                                                                }
                                                                <td class="precio">@iteem.MONTO_BASE</td>
                                                            }
                                                            @if (iteem.ESTATUS == "C")
                                                            {
                                                                <td>Cancelado</td>
                                                            }
                                                            else if (iteem.ESTATUS != "P")
                                                            {
                                                                <td>Pendiente</td>
                                                            }


                                                            @if (ViewBag.recs.Count > 0 & iteem.DOC_REF != null & iteem.DOC_REF != 0)
                                                            {
                                                                foreach (DOCUMENTOL tol in ttol.Where(x => x.NUM_DOC == iteem.DOC_REF).FirstOrDefault().DOCUMENTOLs)
                                                                {
                                                                    if (iteem.DOCUMENTORANs.Where(x => x.LIN == 1).FirstOrDefault().PORCENTAJE == tol.DOCUMENTO.PORC_APOYO)
                                                                    {
                                                                        <td>Contabilizado</td>
                                                                        <td class="precio">@tol.MONTO_VENTA</td>
                                                                        <td class="precio">@(tol.DOCUMENTO.MONTO_DOC_MD)</td>
                                                                        if (Model.D.DOCUMENTORECs.Count > 1)
                                                                        {
                                                                            if (Model.D.PAI.BACKORDER)
                                                                            {
                                                                                if (tol.BACKORDER != null)
                                                                                {
                                                                                    <td class="precio">@(tol.BACKORDER)</td>
                                                                                    <td class="precio">@(tol.MONTO_VENTA + tol.BACKORDER)</td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="precio">0.00</td>
                                                                                    <td class="precio">0.00</td>
                                                                                }
                                                                            }
                                                                            if (rtol.Where(a => a.DOCUMENTO_REF == tol.NUM_DOC).FirstOrDefault() != null)
                                                                            {
                                                                                <td>@rtol.Where(a => a.DOCUMENTO_REF == tol.NUM_DOC).FirstOrDefault().TSOL_ID</td>
                                                                                <td class="precio">@rtol.Where(a => a.DOCUMENTO_REF == tol.NUM_DOC).FirstOrDefault().MONTO_DOC_MD</td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td></td>
                                                                                <td></td>
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        <td></td>
                                                                        <td></td>
                                                                        <td></td>
                                                                        if (Model.D.DOCUMENTORECs.Count > 1)
                                                                        {
                                                                            if (Model.D.PAI.BACKORDER)
                                                                            {
                                                                                <td></td>
                                                                                <td></td>
                                                                            }
                                                                            <td></td>
                                                                            <td></td>
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                            else if (ViewBag.recs.Count > 0)
                                                            {
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                if (Model.D.DOCUMENTORECs.Count > 1)
                                                                {
                                                                    if (Model.D.PAI.BACKORDER)
                                                                    {
                                                                        <td></td>
                                                                        <td></td>
                                                                    }
                                                                    <td></td>
                                                                    <td></td>
                                                                }
                                                            }
                                                        </tr>
                                                                foreach (TAT001.Entities.DOCUMENTORAN ran in iteem.DOCUMENTORANs.Where(x => x.LIN > 1))//RSG 20.09.2018
                                                                {
                                                            @*<tr class="ran-@ran.POS" style="display:none;background-color:rgba(242, 242, 242, 0.5);">
                                                            *@
                                                            <tr class="ran-@ran.POS" style="background-color:rgba(242, 242, 242, 0.5);">
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td class="porcentaje">@ran.PORCENTAJE</td>
                                                                <td class="precio">@ran.OBJETIVOI</td>

                                                                @if (ViewBag.recs.Count > 0 & iteem.DOC_REF != null & iteem.DOC_REF != 0)
                                                                {
                                                                    foreach (DOCUMENTOL tol in ttol.Where(x => x.NUM_DOC == iteem.DOC_REF).FirstOrDefault().DOCUMENTOLs)
                                                                    {
                                                                        if (ran.PORCENTAJE == tol.DOCUMENTO.PORC_APOYO)
                                                                        {
                                                                            <td>Contabilizado</td>
                                                                            <td class="precio">@tol.MONTO_VENTA</td>
                                                                            <td class="precio">@(tol.DOCUMENTO.MONTO_DOC_MD)</td>
                                                                            if (Model.D.DOCUMENTORECs.Count > 1)
                                                                            {
                                                                                if (Model.D.PAI.BACKORDER)
                                                                                {
                                                                                    if (tol.BACKORDER != null)
                                                                                    {
                                                                                        <td class="precio">@(tol.BACKORDER)</td>
                                                                                        <td class="precio">@(tol.MONTO_VENTA + tol.BACKORDER)</td>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <td class="precio">0.00</td>
                                                                                        <td class="precio">0.00</td>
                                                                                    }
                                                                                }
                                                                                if (rtol.Where(a => a.DOCUMENTO_REF == tol.NUM_DOC).FirstOrDefault() != null)
                                                                                {
                                                                                    <td>@rtol.Where(a => a.DOCUMENTO_REF == tol.NUM_DOC).FirstOrDefault().TSOL_ID</td>
                                                                                    <td class="precio">@rtol.Where(a => a.DOCUMENTO_REF == tol.NUM_DOC).FirstOrDefault().MONTO_DOC_MD</td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td></td>
                                                                                    <td></td>
                                                                                }
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <td></td>
                                                                            <td></td>
                                                                            <td></td>
                                                                            if (Model.D.DOCUMENTORECs.Count > 1)
                                                                            {
                                                                                if (Model.D.PAI.BACKORDER)
                                                                                {
                                                                                    <td></td>
                                                                                    <td></td>
                                                                                }
                                                                                <td></td>
                                                                                <td></td>
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                else if (ViewBag.recs.Count > 0)
                                                                {
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td></td>
                                                                    if (Model.D.DOCUMENTORECs.Count > 1)
                                                                    {
                                                                        if (Model.D.PAI.BACKORDER)
                                                                        {
                                                                            <td></td>
                                                                            <td></td>
                                                                        }
                                                                        <td></td>
                                                                        <td></td>
                                                                    }
                                                                }
                                                            </tr>
                                                                    }
                                                                }
                                                </tbody>
                                            </table>
                                        </div>
                                        <script>
                                            function muestraRan(id) {
                                                var ii = id.split('-')[1];
                                                var clas = $("#" + id).hasClass("ran");
                                                if (!clas) {
                                                    var a = document.getElementsByClassName("ran-" + ii);
                                                    var i;
                                                    for (i = 0; i < a.length; i++) {
                                                        a[i].style.display = "table-row";
                                                    }
                                                    document.getElementById("rec-" + ii).classList.add("ran");
                                                }
                                                else {
                                                    var a = document.getElementsByClassName("ran-" + ii);
                                                    var i;
                                                    for (i = 0; i < a.length; i++) {
                                                        a[i].style.display = "none";
                                                    }
                                                    document.getElementById("rec-" + ii).classList.remove("ran");
                                                }
                                            }
                                        </script>
                                    </div>
                                    <br />
                                    @*@if (Convert.ToInt32(caso) == 3)*@
                                    @if (Model.D.OBJETIVOQ == true)
                                    {
                                        decimal? totalMon = 0;
                                        string fechaE = "", periodoE = "";

                                        <div class="row">
                                            <h5>Objetivo Q</h5>
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Pos</th>
                                                        <th>Periodo</th>
                                                        <th>Tipo</th>
                                                        <th>Documento</th>
                                                        <th>Fecha</th>
                                                        <th>%</th>
                                                        <th>Objetivo</th>
                                                        <th>Estatus</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var iteem in Model.D.DOCUMENTORECs)
                                                    {
                                                        totalMon = totalMon + iteem.MONTO_BASE;
                                                        fechaE = iteem.FECHAV.Value.ToShortDateString();
                                                        periodoE = "P" + iteem.PERIODO + "-" + iteem.EJERCICIO;

                                                        <tr>
                                                            <td>Q @iteem.POS</td>
                                                            <td>@periodoE</td>
                                                            <td>@Model.D.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(ViewBag.spras_id)).FirstOrDefault().TXT50</td>
                                                            <td></td>
                                                            <td>@fechaE</td>
                                                            <td class="porcentaje">@Model.D.OBJQ_PORC</td>

                                                            @foreach (TAT001.Entities.DOCUMENTORAN ran in iteem.DOCUMENTORANs.Where(x => x.LIN == 1))//RSG 20.09.2018
                                                            {
                                                                <td class="precio">@ran.OBJETIVOI</td>
                                                            }
                                                            <td>Pendiente</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    }
                                </div>
                            </div>
                            @*
                                </div>
                                </div>*@
                                                                }
                    </div>
                </div>
                                                                }
            @*///////////////////////////////CAMBIOS LGPP FIN//////////////////////////*@
            <div id="supp" class="col s12">
                @{
                    List<TAT001.Entities.DOCUMENTOA>
                    archivos = ViewBag.files as List<TAT001.Entities.DOCUMENTOA>
                    ;
                    string[] nombrefile;
                }
                <div class="row">
                    <div class="col s12 m12 l6">
                        <div class="card-panel">
                            <div class="row">
                                <h5 id="head_docssoporter">Soportes</h5>
                            </div>
                            <div class="row">
                                @using (Html.BeginForm("Descargar", "Solicitudes", FormMethod.Post))
                                {
                                    try
                                    {
                                        for (int i = 0; i < archivos.Count; i++)
                                        {
                                            nombrefile = archivos[i].PATH.Split('\\');

                                            @archivos[i].CLASE
                                            <div class="file-field input-field">
                                                <button id="lbl_cargar" name="archivo" class="btn" type="submit" value="@archivos[i].PATH">DESCARGAR</button>
                                                <div class="file-path-wrapper">
                                                    <input disabled value="@nombrefile[nombrefile.Length - 1]" id="disabled" type="text" class="file-path validate">
                                                </div>
                                            </div>
                                        }
                                    }
                                    catch (Exception)
                                    {
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    @if (ViewBag.acciones != null)
                    {
                        if (ViewBag.accion == "S")
                        {
                            <div class="col s12 m12 l6">
                                <div class="card-panel">
                                    <div class="row">
                                        <h5>Carta</h5>@*FALTA TEXTO DE LA CARTA*@
                                    </div>
                                    <div class="row">
                                        @using (Html.BeginForm("Details", "Solicitudes", FormMethod.Post, new { enctype = "multipart/form-data" }))
                                        {
                                            @Html.AntiForgeryToken()
                                            @Html.HiddenFor(model => model.D.NUM_DOC)
                                            @*<label>Carta</label><label class"lbl_nec">*</label>*@
                                            <label name="labels_soporte2">Acuerdo comercial</label><label class"lbl_nec"></label>
                                            <input type="text" value="Carta" name="labels_soporte" hidden />
                                            <div class="file-field input-field">
                                                <div class="btn-small  " style="float:left;">
                                                    <span>Examinar</span>
                                                    @*<input class="file_soporte nec" name="files_soporte" id="file_carta" type="file">*@
                                                    <input class="file_soporte" name="files_soporte" id="file_carta" type="file">
                                                </div>
                                                <div class="file-path-wrapper">
                                                    <input class="file-path validate" type="text">
                                                </div>
                                            </div>
                                            @*<div class="col s12 right-align">
                                                <input type="submit" value="Enviar" class="btn-small  " />
                                                </div>*@
                                            <div class="col s12 right-align">
                                                <input id="Enviar" type="button" value="Enviar" class="btn-small btnEnviar" />
                                                <input style="display:none" id="btn_guardar" type="submit" value="Guardar" class="btn btn-default" />
                                            </div>
                                            <input type="hidden" id="pos" name="pos" value="0" />
                                        }
                                    </div>
                                </div>
                            </div>
                            <script>
                                  var cartasCount = "@Model.D.CARTAs.Count()";
                            </script>
                            if (ViewBag.cartap.Count != 0)
                            {
                                //LEJ 10.07.2018

                                <div class="col s12 m12 l12">
                                    <div class="row" style="margin-bottom:0">
                                        <div class="card-panel cpC">
                                            <div class="row">
                                                <h5 id="head_selectdis">Seleccionar distribución</h5>
                                                <ul class="collapsible">
                                                    @for (int i = 0; i < pos.Count; i++)
                                                    {
                                                        var lstCF = lstCarta.Where(p => p.POS_ID == pos[i].POS_ID).ToList();
                                                        string idx = "chb" + i;
                                                        <li>
                                                            <div class="collapsible-header">
                                                                <div><i class="material-icons">arrow_drop_down</i></div>
                                                                <label for="@idx">
                                                                    <input type="checkbox" id="@idx" />
                                                                    <span id="Tt-@i">@pos[i].POS_ID</span>
                                                                </label>
                                                            </div>
                                                            <div class="collapsible-body">
                                                                <table class="table highlight responsive-table" style="font-size: 12px;" id="tableC-@i">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Vigencia de</th>
                                                                            <th>Vigencia al </th>
                                                                            <th>Material</th>
                                                                            @*
                                                                                <th>CANTIDAD</th>
                                                                                <th>Monto</th>*@
                                                                            <th>Porc Apoyo</th>
                                                                            <th>Monto Apoyo</th>
                                                                            <th>Precio Sugerido</th>
                                                                            @if (Model.D.TSOL.FACTURA)
                                                                            {
                                                                                <th>Volumen real</th>
                                                                                <th>Apoyo real</th>
                                                                            }
                                                                            else
                                                                            {
                                                                                <th>Volumen Estimado</th>
                                                                                <th>Apoyo Estimado</th>
                                                                            }
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="tb-@i">
                                                                        @for (int y = 0; y < lstCF.Count; y++)
                                                                        {
                                                                            <tr>
                                                                                <td id="_pos-@i-@y" name="_pos-@i" style="display:none;">@lstCF[y].POS_ID</td>
                                                                                <td id="Vigd-@i-@y">@lstCF[y].VIGENCIA_DE.Value.Year/@lstCF[y].VIGENCIA_DE.Value.Month/@lstCF[y].VIGENCIA_DE.Value.Day</td>
                                                                                <td id="Viga-@i-@y-@y">@lstCF[y].VIGENCIA_AL.Value.Year/@lstCF[y].VIGENCIA_AL.Value.Month/@lstCF[y].VIGENCIA_DE.Value.Day</td>
                                                                                <td id="mantr-@i-@y">@lstCF[y].MATNR </td>
                                                                                @*
                                                                                    <td id="cant-@i-@y"> @lstCF[y].CANTIDAD </td>
                                                                                    <td id="pap-@i-@y">@lstCF[y].MONTO </td>*@
                                                                                <td id="papo-@i-@y"> @lstCF[y].PORC_APOYO </td>
                                                                                <td id="mnt-@i-@y">@lstCF[y].MONTO_APOYO </td>
                                                                                <td id="psu-@i-@y">@lstCF[y].PRECIO_SUG </td>
                                                                                @if (Model.D.TSOL.FACTURA)
                                                                                {
                                                                                    <td class="precio" id="vol-@i-@y"> @lstCF[y].VOLUMEN_REAL </td>
                                                                                    <td class="" id="ape-@i-@y"> @lstCF[y].APOYO_REAL </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="precio" id="vol-@i-@y"> @lstCF[y].VOLUMEN_EST </td>
                                                                                    <td class="" id="ape-@i-@y"> @lstCF[y].APOYO_EST </td>
                                                                                }
                                                                            </tr>
                                                                        }
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    }
                    @if (Model.D.DOCUMENTOR != null)
                    {
                        <div class="col s12 m12 l6">
                            <div class="card-panel">
                                <div class="row">
                                    <h5 id="head_soprev">Reversa</h5>
                                </div>
                                <div class="row">
                                    @*@foreach (var iteem in Model.D.DOCUMENTORs)
                                        {*@
                                    <div class="input-field col s12">
                                        <input id="txt_trev" type="text" disabled="disabled" value="@Model.D.DOCUMENTOR.TREVERSA.TREVERSATs.Where(a => a.SPRAS_ID.Equals(ViewBag.spras_id)).FirstOrDefault().TXT100" />
                                        <label for="txt_trev">Tipo de reversa</label>
                                    </div>
                                    <div class="input-field col s12">
                                        <textarea id="txt_comm" disabled="disabled" class="materialize-textarea">@Model.D.DOCUMENTOR.COMENTARIO</textarea>
                                        <label for="txt_comm">Comentario</label>
                                    </div>
                                    @*}*@
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
            <div id="dist" class="col s12">
                <div class="row">
                    @if (Model.D.LIGADA != null)
                    {
                        if ((bool)Model.D.LIGADA & Model.D.DOCUMENTORECs.Count == 0)
                        {
                            @*<div class="col l6 offset-l6 m6 l6">
                                    <div class="card-panel">
                                        <h5>Base para aplicar</h5>
                                        <div class="row" style="margin-bottom:0px;">
                                            <div class="input-field col s6">
                                                <input type="text" value="@Model.D.PORC_APOYO" class="porcentaje" disabled="disabled" id="PORC_APOYO" />
                                                <label for="txt_porc">Porcentaje apoyo</label>
                                            </div>
                                        </div>
                                        @if (Model.D.DOCUMENTOLs.Count > 0)
                                        {
                                            <div class="row">
                                                <div class="input-field col s6">

                                                    <input type="text" value="@Model.D.DOCUMENTOLs.FirstOrDefault().MONTO_VENTA" class="precio" disabled="disabled" id="txt_venta" />
                                                    <label for="txt_porc">Venta del mes</label>
                                                </div>
                                                <div class="input-field col s6">
                                                    <input type="text" value="@Model.D.MONTO_DOC_MD" class="precio" disabled="disabled" id="MONTO_DOC_MD" />
                                                    <label for="txt_porc">Monto base</label>
                                                </div>
                                                <script>
                                                    //function calcValor() {
                                                    ////var venta = ((document.getElementById("MONTO_DOC_MD").value) / (document.getElementById("PORC_APOYO").value)) * 100;
                                                    ////document.getElementById("txt_venta").value = venta;
                                                    //}
                                                </script>
                                            </div>
                                        }
                                    </div>
                                </div>*@
                        }
                    }
                    <div class="col s12">
                        <br />
                        @*///////////////////////////////CAMBIOS LGPP INICIO//////////////////////////*@
                        @using (TAT001Entities db = new TAT001Entities())
                        {
                            <div class="row">
                                <div class="col s12 m6 l6">
                                    <div class="card-panel">
                                        <h5 id="head_dis">Distribución</h5>
                                        @if (Model.D.LIGADA != null && Model.D.LIGADA.Value)
                                        {
                                            <div class="row" style="margin-bottom:0">
                                                <div class="col s6">
                                                    <label>
                                                        <input type="checkbox" checked disabled="disabled"/>
                                                        <span id="span_ligada">Solicitud ligada a facturación </span>
                                                    </label>
                                                    </div>
                                            </div>
                                        }
                                        <div class="row" style="margin-bottom:0">
                                            <div class="input-field col s6">
                                                @Html.EditorFor(model => model.D.TIPO_TECNICO, new { htmlAttributes = new { @disabled = "disabled" } })
                                                @Html.LabelFor(model => model.D.TIPO_TECNICO, "Negociación", htmlAttributes: new { @id = "lbl_tiponeg" })
                                            </div>
                                            <div class="input-field col s6">
                                                @Html.EditorFor(model => model.D.TSOL_ID, new { htmlAttributes = new { @disabled = "disabled", @Value = ViewBag.mat } })
                                                @Html.LabelFor(model => model.D.TSOL_ID, "Distribución", htmlAttributes: new { @id = "lbl_tipodis" })
                                            </div>
                                        </div>
                                    </div>
                                        </div>
                                        <div class="col s12 m6 l6">
                                            <div class="card-panel">

                                                @if ((Model.D.LIGADA != null && Model.D.LIGADA.Value) || Model.D.TIPO_TECNICO=="P")
                                                {
                                                            <h5 id="head_baseaplicar">Base para aplicar %</h5> @*B20180801 MGC Textos*@
                                                            <div class="row" style="margin-bottom:0">
                                                                <div class="input-field col s6">
                                                                    @Html.EditorFor(model => model.D.PORC_APOYO, new { htmlAttributes = new { @disabled = "disabled", @id = "lbl_montodis", @class = "porcentaje" } })
                                                                    <label id="lbl_porcapoyo" for="bmonto_apoyo">% Apoyo</label>@*B20180801 MGC Textos*@
                                                                </div>
                                                            </div>
                                                       
                                                }
                                                else
                                                {
                                                    <h5 id="head_montob">Monto Base</h5>
                                                    <div class="row" style="margin-bottom:0">
                                                        <div class="input-field col s6">
                                                            @Html.EditorFor(model => model.D.MONTO_DOC_MD, new { htmlAttributes = new { @disabled = "disabled", @id = "lbl_montodis", @class = "_vmonto" } })
                                                            @Html.LabelFor(model => model.D.MONTO_DOC_MD, "Monto", htmlAttributes: new { @id = "lbl_montodis" })
                                                        </div>
                                                        <div class="input-field col s6">
                                                            @Html.EditorFor(model => model.D.MONEDA_ID, new { htmlAttributes = new { @disabled = "disabled", @id = "lbl_monedadis" } })
                                                            @Html.LabelFor(model => model.D.MONEDA_ID, "Moneda", htmlAttributes: new { @for = "monedadis_id", @id = "lbl_monedadis" })
                                                        </div>
                                                    </div>
                                                }

                                            </div>
                                        </div>
                                    </div>
                        }
                        @*///////////////////////////////CAMBIOS LGPP FIN//////////////////////////*@
                        <div class="card-panel">
                            <div class="row" style="margin-bottom:0">
                                <h5 id="head_mecnegociacion">Distribución</h5>
                                <div class="input-field col s12" style="overflow:auto;">
                                    @if (Model.D.DOCUMENTOPs.Count > 0)
                                    {
                                        <table style="font-size: 12px;" id="ctlDis" class="table">
                                            <thead>
                                                <tr>
                                                    <th id="thead_disvde">Vigencia de</th>
                                                    <th id="thead_disval">Vigencia a</th>
                                                    @if (Model.D.DOCUMENTOPs.First().MATNR != "")
                                                    {
                                                        <th id="thead_dismat">Material</th>
                                                    }
                                                    else
                                                    {
                                                        <th id="thead_discat">Categoría</th>
                                                    }
                                                    <th id="thead_disdesc">Descripción</th>
                                                    <th id="thead_discoustou">Precio unitario</th>
                                                    <th id="thead_disporc">% apoyo</th>
                                                    <th id="thead_disapoyop">Apoyo por pieza</th>
                                                    <th id="thead_dispsug">Precio sugerido</th>
                                                    @if (Model.D.TSOL.FACTURA == false)
                                                    {
                                                        <th id="thead_disvolumen">Volumen estimado</th>
                                                        <th id="thead_disvapoyo">Apoyo estimado</th>
                                                    }
                                                    else
                                                    {
                                                        <th id="thead_disvolumen">Volumen real</th>
                                                        <th id="thead_disapoyo">Apoyo real</th>
                                                    }
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in Model.D.DOCUMENTOPs.Where(a => a.VIGENCIA_DE != null & (a.MATNR != "" | a.MATKL != null)))
                                                {
                                                    <tr id="pos-@item.POS" onclick="muestra(this.id)">
                                                        <td>
                                                            @try
                                                            {@item.VIGENCIA_DE.Value.ToShortDateString()}
                                                            catch { }
                                                        </td>
                                                        <td>
                                                            @try
                                                            {@item.VIGENCIA_AL.Value.ToShortDateString()}
                                                            catch { }
                                                        </td>
                                                        @if (item.MATNR != "")
                                                        {
                                                            <td>@item.MATNR.TrimStart('0')</td>
                                                        }
                                                        else
                                                        {
                                                            <td>@item.MATKL</td>
                                                        }
                                                        @{
                                                            using (TAT001.Entities.TAT001Entities db = new TAT001.Entities.TAT001Entities())
                                                            {
                                                                if (item.MATNR != "")
                                                                {
                                                                    string spras = ViewBag.spras_id;
                                                                    var matnr = db.MATERIALTs.Where(x => x.MATERIAL_ID == item.MATNR & x.SPRAS == spras).FirstOrDefault();
                                                                    if (matnr != null)
                                                                    {
                                                                        <td>@matnr.MAKTG</td>}
                                                                    else
                                                                    {
                                                                        <td></td>
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    var matkl = db.MATERIALGPs.Find(item.MATKL);
                                                                    if (matkl != null)
                                                                    {
                                                                        <td>@matkl.MATERIALGPTs.Where(a => a.SPRAS_ID.Equals("EN")).FirstOrDefault().TXT50 </td>}
                                                                    else
                                                                    {
                                                                        <td></td>
                                                                    }
                                                                }

                                                            }
                                                        }
                                                        @*LEJ 12.07.18 Añadi un identificador para modificarse dinamicamente*@
                                                        <td id="dsMn-@idn">@Math.Round(item.MONTO, 2)</td>
                                                        <td id="dsPAp-@idn">@Math.Round(item.PORC_APOYO, 2)</td>
                                                        <td id="dsApo-@idn">@Math.Round(item.MONTO_APOYO, 2)</td>
                                                        <td id="dsPS-@idn">@Math.Round(item.PRECIO_SUG, 2)</td>
                                                        @if (Model.D.TSOL.FACTURA == false)
                                                        {
                                                            <td id="dsVE-@idn">@Math.Round(item.VOLUMEN_EST, 2)</td>
                                                            <td id="dsAE-@idn">@Math.Round((decimal)item.APOYO_EST, 2)</td>
                                                        }
                                                        else
                                                        {
                                                            <td id="dsVR-@idn">@Math.Round((decimal)item.VOLUMEN_REAL, 2)</td>
                                                            <td id="dsAR-@idn">@Math.Round(((decimal)item.APOYO_REAL), 2)</td>
                                                        }
                                                    </tr>
                                                    @*LEJ 12.07.18 Añadi un identificador para modificarse dinamicamente*@
                                                foreach (var mat in item.DOCUMENTOMs)
                                                {
                                                        <tr class="mat-@mat.POS_ID grey lighten-4" style="display:none;">
                                                            <td></td>
                                                            <td></td>
                                                            <td>@mat.MATNR.TrimStart('0')</td>
                                                            @{
                                                                using (TAT001.Entities.TAT001Entities db = new TAT001.Entities.TAT001Entities())
                                                                {
                                                                    if (mat.MATNR != "")
                                                                    {
                                                                        var matnr = db.MATERIALs.Find(mat.MATNR);
                                                                        if (matnr != null)
                                                                        {
                                                                            <td>@matnr.MAKTX</td>}
                                                                        else
                                                                        {
                                                                            <td></td>
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            @if (Model.D.TSOL.FACTURA == false)
                                                            {
                                                                <td class="precio">@Math.Round((decimal)mat.APOYO_EST, 2)</td>
                                                            }
                                                            else
                                                            {
                                                                <td class="precio">
                                                                    @Math.Round((decimal)mat.APOYO_REAL, 2)
                                                                </td>
                                                            }
                                                        </tr>

                                                                    }
                                                                    idn++;//LEJ 12.07.18
                                                                }
                                            </tbody>
                                        </table>
                                                                }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script src="~/Scripts/formatos.js"></script>
                <script>
                    function muestra(id) {
                        var ii = id.split('-')[1];
                        var clas = $("#" + id).hasClass("m");
                        if (!clas) {
                            var a = document.getElementsByClassName("mat-" + ii);
                            var i;
                            for (i = 0; i < a.length; i++) {
                                a[i].style.display = "table-row";
                            }
                            document.getElementById("pos-" + ii).classList.add("m");
                        }
                        else {
                            var a = document.getElementsByClassName("mat-" + ii);
                            var i;
                            for (i = 0; i < a.length; i++) {
                                a[i].style.display = "none";
                            }
                            document.getElementById("pos-" + ii).classList.remove("m");
                        }

                    }
                </script>
            </div>
            <div id="fina" class="col s12">
                <div class="row">
                    @if (ViewBag.acciones != null)
                    {
                        if (ViewBag.accion == "T")
                        {
                            <div class="col s12 m12 l12">
                                @using (Html.BeginForm("Taxeo", "Solicitudes"))
                                {
                                    @Html.AntiForgeryToken()
                                    @Html.HiddenFor(model => model.D.NUM_DOC)
                                    <div class="card-panel">
                                        <h5>Taxeo</h5>
                                        <div class="row">
                                            <div class="col s12 m12 l12">
                                                <div class="row" id="lbl_taxeo">
                                                    <div class="input-field col s6 m6 l3">
                                                        <select id="txt_concepto" name="txt_concepto" onchange="selConcepto(this.value)">
                                                            <option value=""></option>
                                                        </select>
                                                        <label for="txt_concepto">Concepto</label>
                                                    </div>
                                                    <div class="input-field col s6 m6 l3">
                                                        <input id="txt_nota" name="txt_nota" disabled="disabled" />
                                                        <label id="lbl_nota" for="txt_nota">Tipo de nota</label>
                                                    </div>
                                                    <div class="col s12 m12 l6">
                                                        <div>
                                                            <table class="table" id="tab_conc">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Concepto</th>
                                                                        <th>Porcentaje</th>
                                                                        <th>Código</th>
                                                                        <th>Totales</th>
                                                                    </tr>
                                                                <thead>
                                                                <tbody></tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                <script>
                                    taxeo("txt_concepto");

                                    function taxeo(id) {
                                        var campo = document.getElementById(id);
                                        $("#" + id).find('option').remove();
                                        //$("#lbl_puestos").empty();
                                        ///1

                                        /**/
                                        /**/
                                        /**/
                                        var soci = '@Model.D.SOCIEDAD_ID';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var pais = '@Model.D.PAIS_ID';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var vkorg = '@Model.D.VKORG';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var vtweg = '@Model.D.VTWEG';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var spart = '@Model.D.SPART';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var kunnr = '@Model.D.PAYER_ID';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var spras = '@ViewBag.spras_id';
                                    /**/
                                    /**/
                                    /**/
                                    $.ajax({
                                        url: root+"Listas/selectTaxeo",
                                        type: "GET",
                                        async: false,
                                        timeout: 30000,
                                        dataType: "json",
                                        data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, spras: spras },
                                        success: function (data) {
                                            var pp = ($.map(data, function (item) {
                                                return { label: item.TXT50, value: item.CONCEPTO_ID };
                                            }))
                                            $("#" + id)
                                                .append($("<option></option>")
                                                    .attr("value", "")
                                                    .text(""));
                                            for (var i = 0; i < pp.length; i++) {
                                                //var div =  "<option value='" + pp[i].value + "'>" + pp[i].label + "</option>"
                                                //$("#txt_pai").append(div);
                                                $("#" + id)
                                                    .append($("<option></option>")
                                                        .attr("value", pp[i].value)
                                                        .text(pp[i].label));
                                            }
                                            var el = document.getElementById(id);
                                            var instances = M.FormSelect.init(el, []);
                                        }
                                    });
                                }

                                function selConcepto(value) {
                                    //2
                                    //$("#lbl_puestos").empty();
                                    /**/
                                    /**/
                                    /**/
                                    var soci = '@Model.D.SOCIEDAD_ID';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var pais = '@Model.D.PAIS_ID';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var vkorg = '@Model.D.VKORG';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var vtweg = '@Model.D.VTWEG';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var spart = '@Model.D.SPART';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var kunnr = '@Model.D.PAYER_ID';
                                    /**/
                                    /**/
                                    /**/
                                    var concepto_id = value;
                                    /**/
                                    /**/
                                    /**/
                                    var spras = '@ViewBag.spras_id';
                                    /**/
                                    /**/
                                    /**/
                                    $.ajax({
                                        url: root+"Listas/selectConcepto",
                                        type: "POST",
                                        async: false,
                                        timeout: 30000,
                                        dataType: "json",
                                        data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, concepto: concepto_id, spras: spras },
                                        success: function (data) {
                                            var pp = ($.map(data, function (item) {
                                                return { label: item.TXT50, value: item.CONCEPTO_ID };
                                            }))
                                            if (pp.length > 0) {
                                                $("#txt_nota").val(pp[0].label);
                                                $("#lbl_nota").addClass("active");
                                            }
                                            else {
                                                $("#txt_nota").val("");
                                                $("#lbl_nota").removeClass("active");
                                            }
                                        }
                                    });
                                    $.ajax({
                                        url: root +"Listas/selectImpuesto",
                                        type: "POST",
                                        async: false,
                                        timeout: 30000,
                                        dataType: "json",
                                        data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, concepto: concepto_id, spras: spras },
                                        success: function (data) {
                                            $("#tab_conc tbody").empty();
                                            var pp = ($.map(data, function (item) {
                                                return { IMPUESTO_ID: item.IMPUESTO_ID, PORC: item.PORC, TEXT: item.TXT50 };
                                            }))
                                            for (var i = 0; i < pp.length; i++) {
                                                var cod = pp[i].IMPUESTO_ID;
                                                var por = pp[i].PORC;
                                                /**/
                                                /**/
                                                /**/
                                                var tot = @Model.D.MONTO_DOC_ML;
                                    /**/
                                    /**/
                                    /**/
                                    var sub = tot * por / 100;

                                    $("#tab_conc tbody").append("<tr><td>" + pp[i].TEXT + "</td><td>" + toShow(por / 100) + "%</td><td>" + cod + "</td><td>" + toShow(sub) + "</td><tr>");
                                }
                            }
                        });
                    }
                                                </script>
                                            </div>
                                            <div class="col s12 right-align">
                                                <input type="submit" class="btn" value="Enviar" />
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                    }
                    <div class="col s12 m6 l6">
                        <div class="card-panel">
                            <h5>Detalle de solicitud</h5>
                            <div class="row" style="margin-bottom:0">
                                <div class="input-field col s8">
                                    @if (ViewBag.accion == "N")
                                    {
                                        @Html.EditorFor(model => model.D.MONTO_DOC_MD)
                                    }
                                    @Html.EditorFor(model => model.D.MONTO_DOC_MD, new { htmlAttributes = new { @disabled = "disabled", @class = "_vmonto" } })
                                    @Html.LabelFor(model => model.D.MONTO_DOC_MD, "Monto", new { @id = "lbl_montomd" })
                                </div>
                                <div class="input-field col s4">
                                    @Html.EditorFor(model => model.D.MONEDA_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.MONEDA_ID, "Moneda", new { @id = "lbl_waers" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.TIPO_CAMBIO, new { htmlAttributes = new { @disabled = "disabled", @class = "_tc" } })
                                    @Html.LabelFor(model => model.D.TIPO_CAMBIO, "Tipo de cambio", new { @id = "lbl_tcambio" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.MONTO_DOC_ML2, new { htmlAttributes = new { @disabled = "disabled", @class = "_vmonto2" } })
                                    @Html.LabelFor(model => model.D.MONTO_DOC_ML2, "Monto USD", new { @id = "lbl_montoml2" })
                                </div>
                                @if (Model.D.TSOL.PADRE)
                                {
                                    <div class="input-field col s4">
                                        @*@Html.EditorFor(model => model.D.TSOL_ID, new { htmlAttributes = new { @disabled = "disabled" } })*@
                                        @Html.EditorFor(model => model.D.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(model.D.USUARIO.SPRAS_ID)).FirstOrDefault().TXT50, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.TSOL_ID, "Tipo de solicitud", new { @class = "lbl_tsol" })
                                    </div>
                                    <div class="input-field col s4">
                                        @Html.EditorFor(model => model.D.DOCUMENTO_SAP, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.DOCUMENTO_SAP, "No. Documento SAP", new { @id = "lbl_sap" })
                                    </div>
                                    <div class="input-field col s4">
                                        @Html.EditorFor(model => model.D.SOCIEDAD_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.SOCIEDAD_ID, "Company code", new { @class = "lbl_bu" })
                                    </div>
                                    <div class="input-field col s6">
                                        @Html.EditorFor(model => model.D.PERIODO, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.PERIODO, "Periodssso", new { @class = "lbl_periodo" })
                                    </div>
                                    <div class="input-field col s6">
                                        @Html.EditorFor(model => model.D.EJERCICIO, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio", new { @class = "lbl_ejer" })
                                    </div>
                                }
                                @*<div class="input-field col s12">
                                    @Html.TextAreaFor(model => model.D.NOTAS, new { @id = "txt_notas", @class = "materialize-textarea", @style = "height:500px;", @disabled = "disabled" })
                                    @Html.LabelFor(model => model.D.NOTAS, "Mecánica de negociación", new { @id = "lbl_notas" })
                                    </div>*@
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m6 l6 right">
                        <!--RSG 22.05.2018-->
                        <div class="card-panel">
                            <div class="row">
                                <h5>Cuentas</h5>
                                <div class="col s12">
                                    <div id="div_clearing">
                                    </div>
                                </div>
                            </div>
                            <script>
                            var clearing = [];
                            function getClearing(gall) {
                                $("#div_clearing").empty();
                                clearing = [];
                                /**/
                                /**/
                                /**/
                                /**/
                                var bukrs = '@Model.D.SOCIEDAD_ID';
                            /**/
                            /**/
                            /**/
                            /**/
                            /**/
                            /**/
                            /**/
                            /**/
                            var land = '@Model.D.PAIS_ID';
                            /**/
                            /**/
                            /**/
                            /**/
                            /**/
                            /**/
                            /**/
                            /**/
                            var ejercicio = '@Model.D.EJERCICIO';
                            /**/
                            /**/
                            /**/
                            /**/
                            $.ajax({
                                type: "POST",
                                url: root +'Listas/clearing',
                                dataType: "json",
                                data: { bukrs: bukrs, land: land, gall: gall, ejercicio: ejercicio },

                                success: function (data) {
                                    if (data !== null || data !== "") {
                                        //RSG 26.04.2018----------------
                                        clearing.push(data.ABONO);
                                        clearing.push(data.CARGO);
                                        clearing.push(data.CLEARING);
                                        clearing.push(data.LIMITE);
                                        //RSG 26.04.2018----------------
                                    }

                                },
                                error: function (xhr, httpStatusMessage, customErrorMessage) {
                                    M.toast({ html: httpStatusMessage });
                                },
                                async: false
                            });

                        }
                        function formaClearing() {
                            getClearing(document.getElementById("tall_id").value);
                            $("#div_clearing").empty();
                            var monto = document.getElementById("monto_dis").value;
                            //DRS 24.09.18---------------------------------------------
                            var nombreC = document.getElementById("cuentaNombre").value;
                            var nombreC2 = document.getElementById("cuentaNombre2").value;

                            //LEJ 09.07.18---------------------------------------------
                            var _monto = monto.split('.');
                            var _miles = document.getElementById("miles").value;
                            var _decimales = document.getElementById("dec").value;
                            var _millesMonto = _monto[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g, _miles);
                            var div = "<ul class='collection'><li class='collection-item'>";
                            //DRS 24.09.18
                            div += "<div class='row' style='margin-bottom:0;'><div class='col s3'>Abono</div><div class='col s3'>" + nombreC + "</div><div class='col s3'>" + clearing[0] + "</div><div class='col s3 right-align'>$" + _millesMonto + _decimales + _monto[1] + "</div>";
                            div += "</li><li class='collection-item'>";
                            if (clearing[3] == null) {
                                div += "<div class='row' style='margin-bottom:0;'><div class='col s3'>Cargo</div><div class='col s3'>" + nombreC2 + "</div><div class='col s3'>" + clearing[1] + "</div><div class='col s3 right-align'>$" + _millesMonto + _decimales + _monto[1] + "</div>";
                            }
                            else {
                                if (clearing[2] != null) {
                                    if (monto <= clearing[3]) {
                                        div += "<div class='row' style='margin-bottom:0;'><div class='col s4'>Cargo</div><div class='col s4'>" + clearing[1] + "</div><div class='col s4 right-align'>$" + _millesMonto + _decimales + _monto[1] + "</div></div>";
                                        div += "</li><li class='collection-item'>                                        ";
                                        div += "<div class='row' style='margin-bottom:0;'><div class='col s4'>Clearing</div><div class='col s4'>" + clearing[2] + "</div><div class='col s4 right-align'>$0.00</div></div>";
                                        div += "    </li>";
                                    }
                                    else {
                                        div += "  <div class='row' style='margin-bottom:0;'><div class='col s4'>Cargo</div><div class='col s4'>" + clearing[1] + "</div><div class='col s4 right-align'>$" + clearing[3] + "</div></div>";
                                        div += "</li><li class='collection-item'>                                     ";
                                        div += "<div class='row' style='margin-bottom:0;'><div class='col s4'>Clearing</div><div class='col s4'>" + clearing[2] + "</div><div class='col s4 right-align'>$" + (monto - clearing[3]) + "</div></div>";
                                        div += "          </li>";
                                    }
                                }
                            }
                            div += "</li>";
                            div += "       </ul>";
                            $("#div_clearing").append(div);
                        }
                            </script>
                        </div>
                        @using (TAT001Entities db = new TAT001Entities())
                        {
                            List<DOCUMENTO>
                            inf = new List<DOCUMENTO>
                            ();
                            inf = db.DOCUMENTOes.Where(x => x.DOCUMENTO_REF == Model.D.NUM_DOC).ToList();
                            <div class="card-panel">
                                <div class="row">
                                    <h5>Relacionados</h5>
                                    <div class="col s12">
                                        @if (inf.Count() > 0)
                                        {
                                            <table class="table striped" id="table" style="width:100%; font-size:12px;">
                                                <thead>
                                                    <tr class="header">
                                                        <th>
                                                            @* -----------DRS 24.09.18-------- *@
                                                            @Html.LabelFor(model => model.D.TSOL.TSOLTs.First().TXT010, "Tipo")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.NUM_DOC, "Documento")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.DOCUMENTO_SAP, "SAP")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.SOCIEDAD_ID, "Sociedad")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.PERIODO, "Periodo")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio")
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var miCi in inf)
                                                    {
                                                        <tr>
                                                            <td>
                                                                @miCi.TSOL.TSOLTs.Where(x => x.SPRAS_ID == ViewBag.spras_id).FirstOrDefault().TXT010
                                                            </td>
                                                            <td>
                                                                <a href="@Url.Action("Details", new { id = miCi.NUM_DOC })">@miCi.NUM_DOC</a>
                                                            </td>
                                                            <td>
                                                                @miCi.DOCUMENTO_SAP
                                                            </td>
                                                            <td>
                                                                @miCi.SOCIEDAD_ID
                                                            </td>
                                                            <td>
                                                                @miCi.PERIODO
                                                            </td>
                                                            <td>
                                                                @miCi.EJERCICIO
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        }
                                        else
                                        {
                                            <table class="table striped" id="table" style="width:100%; font-size:12px;">
                                                <thead>
                                                    <tr class="header">
                                                        <th>
                                                            @Html.LabelFor(model => model.D.TSOL_ID, "Tipo")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.NUM_DOC, "Documento")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.DOCUMENTO_SAP, "SAP")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.SOCIEDAD_ID, "Sociedad")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.PERIODO, "Periodo")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio")
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            @Model.D.TSOL.TSOLTs.Where(x => x.SPRAS_ID == ViewBag.spras_id).FirstOrDefault().TXT010
                                                        </td>
                                                        <td>
                                                            @Model.D.NUM_DOC
                                                        </td>
                                                        <td>
                                                            @Model.D.DOCUMENTO_SAP
                                                        </td>
                                                        <td>
                                                            @Model.D.SOCIEDAD_ID
                                                        </td>
                                                        <td>
                                                            @Model.D.PERIODO
                                                        </td>
                                                        <td>
                                                            @Model.D.EJERCICIO
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                        @*///////////////////////////////L.G.P.P MODIFICACIONES INICIO*@
                        <div class="card-panel">
                            <h5><span id="head_analisispre">Análisis Presupuesto</span><p style="font-size:15px"><span id="load_carga">Última fecha de carga</span> @ViewBag.ultMod</p></h5>
                            <div class="row" style="margin-bottom:0">
                                <ul class="collection">
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s4">
                                                <div id="lbl_presupuestocanal">Presupuesto canal</div>
                                            </div>
                                            <div class="col s5">
                                                @* ----DRS 3.10.2018--- *@
                                                <b id="p_vtweg" style="font-size:11px">
                                                    aaaa
                                                </b>
                                            </div>
                                            <div class="col s3 right-align">
                                                @* ----DRS 3.10.2018--- *@
                                                <b id="p_canal" style="font-size:11px">
                                                    1111
                                                </b>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s4">
                                                <div id="lbl_presupuestocliente">Presupuesto cliente</div>
                                            </div>
                                            <div class="col s5">
                                                @* ----DRS 3.10.2018--- *@
                                                <b id="p_kunnr" style="font-size:10px">
                                                </b>
                                            </div>
                                            <div class="col s3 right-align">
                                                @* ----DRS 3.10.2018--- *@
                                                <b id="p_banner" style="font-size:11px">
                                                </b>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="row">
                                <ul class="collection">
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s6">
                                                <div id="lbl_regsap">Registrado en SAP</div>
                                            </div>
                                            <div class="col s3 right-align">
                                                <div id="pc_c">
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s6">
                                                <div id="lbl_regsapp">Por registrar en SAP</div>
                                            </div>
                                            <div class="col s3 right-align">
                                                <div id="pc_a">
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s6">
                                                <div id="lbl_procesotat">En proceso TAT</div>
                                            </div>
                                            <div class="col s3 right-align">
                                                <u id="pc_p">
                                                </u>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s6">
                                                <div id="lbl_consumido">Consumido</div>
                                            </div>
                                            <div class="col s6 right-align">
                                                <u>

                                                    <b id="pc_t">
                                                    </b>
                                                </u>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s6">
                                                <div id="lbl_presudisponible">Presupuesto disponible</div>
                                            </div>
                                            <div class="col s6 right-align">

                                                <b id="consu">
                                                </b>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                @*</ul>*@
                            </div>
                        </div>
                        @*///////////////////////////////L.G.P.P MODIFICACIONES FIN*@
                    </div>
                    @if (Model.D.CONCEPTO_ID != null)
                    {<div class="col s12 m12 l12">
                            <div class="card-panel">
                                <h5>Taxeo</h5>
                                <div class="row">
                                    <div class="col s12 m12 l12">
                                        <div class="row" id="lbl_taxeo">
                                            <div class="input-field col s6 m6 l3">
                                                <input type="text" id="txt_concepto" name="txt_concepto" value="@Model.D.CONCEPTO_ID" disabled="disabled" />
                                                <label for="txt_concepto">Concepto</label>
                                            </div>
                                            <div class="input-field col s6 m6 l3">
                                                <input id="txt_nota" name="txt_nota" disabled="disabled" />
                                                <label id="lbl_nota" for="txt_nota">Tipo de nota</label>
                                            </div>
                                            <div class="col s12 m12 l6">
                                                <div>
                                                    <table class="table" id="tab_conc">
                                                        <thead>
                                                            <tr>
                                                                <th>Concepto</th>
                                                                <th>Porcentaje</th>
                                                                <th>Código</th>
                                                                <th>Totales</th>
                                                            </tr>
                                                        <thead>
                                                        <tbody></tbody>
                                                        <tfoot>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <script>
                                    selConcepto(document.getElementById("txt_concepto").value);


                                    function selConcepto(value) {
                                        //3
                                        //$("#lbl_puestos").empty();
                                        /**/
                                        /**/
                                        /**/
                                        var soci = '@Model.D.SOCIEDAD_ID';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var pais = '@Model.D.PAIS_ID';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var vkorg = '@Model.D.VKORG';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var vtweg = '@Model.D.VTWEG';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var spart = '@Model.D.SPART';
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    /**/
                                    var kunnr = '@Model.D.PAYER_ID';
                                    /**/
                                    /**/
                                    /**/
                                    var concepto_id = value;
                                    /**/
                                    /**/
                                    /**/
                                    var spras = '@ViewBag.spras_id';
                                    /**/
                                    /**/
                                    /**/
                                    $.ajax({
                                        url: root +"Listas/selectConcepto",
                                        type: "POST",
                                        async: false,
                                        timeout: 30000,
                                        dataType: "json",
                                        data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, concepto: concepto_id, spras: spras },
                                        success: function (data) {
                                            var pp = ($.map(data, function (item) {
                                                return { label: item.TXT50, value: item.CONCEPTO_ID };
                                            }))
                                            if (pp.length > 0) {
                                                $("#txt_nota").val(pp[0].label);
                                                $("#lbl_nota").addClass("active");
                                            }
                                            else {
                                                $("#txt_nota").val("");
                                                $("#lbl_nota").removeClass("active");
                                            }
                                        }
                                    });
                                    $.ajax({
                                        url: root +"Listas/selectImpuesto",
                                        type: "POST",
                                        async: false,
                                        timeout: 30000,
                                        dataType: "json",
                                        data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, concepto: concepto_id, spras: spras },
                                        success: function (data) {
                                            $("#tab_conc tbody").empty();
                                            var pp = ($.map(data, function (item) {
                                                return { IMPUESTO_ID: item.IMPUESTO_ID, PORC: item.PORC, label: item.TXT50 };
                                            }))
                                            /**/
                                            /**/
                                            /**/
                                            var foot = @Model.D.MONTO_DOC_ML;
                                    /**/
                                    /**/
                                    /**/
                                    for (var i = 0; i < pp.length; i++) {
                                        var cod = pp[i].IMPUESTO_ID;
                                        var por = pp[i].PORC;
                                        /**/
                                        /**/
                                        /**/
                                        var tot = @Model.D.MONTO_DOC_ML;
                                    /**/
                                    /**/
                                    /**/
                                    var sub = tot * por / 100;
                                    foot = foot + sub;

                                    $("#tab_conc tbody").append("<tr><td>" + pp[i].label + "</td><td>" + toShowPorc(por / 100) + "</td><td>" + cod + "</td><td>" + toShow(sub) + "</td><tr>");
                                }

                                $("#tab_conc tfoot").append("<tr><td></td><td></td><td></td><th>" + toShow(foot) + "</th><tr>");
                            }
                        });
                    }
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>

                    }
                    @if (ViewBag.Relacionados != null)
                    {
                        if (ViewBag.Relacionados.Count > 0)
                        {

                            <div class="col s12 m6 l6">
                                <div class="card-panel">
                                    <h5>Relacionados</h5>
                                    <div class="row" style="margin-bottom:0">
                                        <div class="col s12">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Documento</th>
                                                        <th>Tipo Solicitud</th>
                                                        @*
                                                            <th>Fecha</th>
                                                            <th>Hora</th>*@
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (TAT001.Entities.DOCUMENTO item in ViewBag.Relacionados)
                                                    {
                                                        <tr>
                                                            <td>
                                                                @item.NUM_DOC
                                                            </td>
                                                            <td>
                                                                @item.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(ViewBag.spras_id)).FirstOrDefault().TXT50
                                                            </td>
                                                            @*
                                                                <td>
                                                                @item.FECHAC.Value.ToShortDateString()
                                                                </td>
                                                                <td>
                                                                @item.HORAC.Value.ToString().Split('.')[0]
                                                                </td>*@
                                                            <td>
                                                                <a href="@Url.Action("Details", new { id = item.NUM_DOC })" class="btn-small">Ver</a>
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>}
                    }
                </div>
            </div>
            @*<div id="dist" class="col s12">Test 4</div>*@
        </div>
        <script>
            var el = document.getElementById("tab");
            options = [];
            var instance = M.Tabs.init(el, options);
        </script>
    </div>
                                                                if (ViewBag.acciones != null)
                                                                {
                                                                    using (Html.BeginForm("Procesa", "Flujos"))
                                                                    {
            <div id="modal1" class="modal  bottom-sheet">
                @Html.AntiForgeryToken()
                <div class="modal-content">
                    <div class="row">
                        <h4 id="txt_app" style="display:none">Aprobar solicitud</h4>
                        <h4 id="txt_rec" style="display:none"> Rechazar solicitud</h4>
                        <h4 id="txt_nex" style="display:none"> Agregar comentario</h4>
                        <h4 id="txt_cont" style="display:none">
                            Contabilizar
                        </h4>
                        <br />
                    </div>
                    <div class="row" style="">
                        <div class="col s12 m12 l12">
                            <div class="row" style="margin-bottom:0">
                                @Html.HiddenFor(model => model.F.WORKF_ID)
                                @*@Html.LabelFor(model => model.F.WORKF_ID, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.WF_VERSION)
                                @*@Html.LabelFor(model => model.F.WF_VERSION, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.WF_POS)
                                @*@Html.LabelFor(model => model.F.WF_POS, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.NUM_DOC)
                                @*@Html.LabelFor(model => model.F.NUM_DOC, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.LOOP)
                                @*@Html.LabelFor(model => model.F.LOOP, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.ESTATUS, new { @id = "wf_estatus" })
                                @*@Html.LabelFor(model => model.F.ESTATUS, new { @id = "lbl_userid" })*@
                                <div class="input-field col s10 offset-s1">
                                    @Html.TextAreaFor(model => model.F.COMENTARIO, new { @class = "materialize-textarea", @id = "txt_comentario", @maxlength = 255 })
                                    @Html.LabelFor(model => model.F.COMENTARIO, new { @id = "lbl_userid" })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-fixed-footer right">
                    <a href="#!" class="modal-action modal-close btn-flat">Cancelar</a>
                    <input type="submit" value="Aceptar" class="modal-action modal-close btn-flat" onclick="document.getElementById('loader').style.display = 'initial';" />
                    @*<a class="btn-small btn-default" href="@Url.Action("Details", "Solicitudes" , new { id=Model.F.NUM_DOC})">Cancelar</a>*@
                </div>
            </div>
                                                                        if (ViewBag.accion == "R")
                                                                        {
                <div class="row" style="font-size:12px;">
                    <div class="col s12">
                        <div class="row" style="margin-bottom:0">
                            <div class="card-panel">
                                <div class="row">
                                    <h5>Trade Spending</h5>
                                </div>
                                <div class="row">
                                    <div class="col l6 m6 s12">
                                        @foreach (var item in ViewBag.ts)
                                        {
                                            <div class="col s12">
                                                <p style="margin-top:0;">
                                                    <label>
                                                        @foreach (var ii in item.TS_CAMPO.TS_FORMT)
                                                        {
                                                            if (ii.SPRAS_ID == ViewBag.spras_id)
                                                            {
                                                                <input type="checkbox" id="chk-@item.TS_CAMPO.ID" name="chk-@item.TS_CAMPO.ID" class="trade" />
                                                                <span>@ii.TXT100</span>
                                                            }
                                                        }
                                                    </label>
                                                </p>
                                            </div>
                                        }
                                    </div>
                                    @*<div class="col s8 right-align">
                                        <input type="submit" value="Calificar" class="btn-small  " />
                                        </div>*@
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                                                                        }
            <script>

                var elem = document.getElementById('modal1');
                M.Modal.init(elem, []);
                var elem2 = document.getElementById('modal2');
                if (elem2 != undefined)
                    M.Modal.init(elem2, []);


                function aprobar() {
                    document.getElementById("txt_app").style.display = 'initial';
                    document.getElementById("txt_rec").style.display = 'none';
                    document.getElementById("txt_nex").style.display = 'none';
                    document.getElementById("txt_cont").style.display = 'none';
                    document.getElementById("txt_comentario").value = '';
                    document.getElementById("wf_estatus").value = 'A';
                }
                function rechazar() {
                    document.getElementById("txt_rec").style.display = 'initial';
                    document.getElementById("txt_app").style.display = 'none';
                    document.getElementById("txt_nex").style.display = 'none';
                    document.getElementById("txt_cont").style.display = 'none';
                    document.getElementById("txt_comentario").value = '';
                    document.getElementById("wf_estatus").value = 'R';
                }
                function siguiente() {
                    document.getElementById("txt_rec").style.display = 'none';
                    document.getElementById("txt_app").style.display = 'none';
                    document.getElementById("txt_nex").style.display = 'initial';
                    document.getElementById("txt_cont").style.display = 'none';
                    document.getElementById("txt_comentario").value = '';
                    document.getElementById("wf_estatus").value = 'A';
                }
                function contabilizar() {
                    document.getElementById("txt_rec").style.display = 'none';
                    document.getElementById("txt_app").style.display = 'none';
                    document.getElementById("txt_nex").style.display = 'none';
                    document.getElementById("txt_cont").style.display = 'initial';
                    document.getElementById("txt_comentario").value = '';
                    document.getElementById("wf_estatus").value = 'A';
                }
            </script>
                                                                    }
                                                                }
                                                                if (ViewBag.tts.Count != 0)
                                                                {

        <div class="row" style="font-size:12px;">
            <div class="col s12">
                <div class="row" style="margin-bottom:0">
                    <div class="card-panel">
                        <div class="row">
                            <h5>Trade Spending</h5>
                        </div>
                        <div class="row">
                            <div class="col l4 m4 s12">
                                @foreach (var item in ViewBag.tts)
                                {
                                    <div class="col s12">
                                        <p style="margin-top:0;">
                                            <label>
                                                @foreach (var ii in item.TS_CAMPO.TS_FORMT)
                                                {
                                                    if (ii.SPRAS_ID == ViewBag.spras_id)
                                                    {
                                                        if (item.CHECKS)
                                                        {
                                                            <input type="checkbox" id="chk-@item.TS_CAMPO.ID" name="chk-@item.TS_CAMPO.ID" checked="checked" disabled="disabled" />
                                                        }
                                                        else
                                                        {
                                                            <input type="checkbox" id="chk-@item.TS_CAMPO.ID" name="chk-@item.TS_CAMPO.ID" disabled="disabled" />
                                                        }
                                                        <span>@ii.TXT100</span>
                                                    }
                                                }
                                            </label>
                                        </p>
                                    </div>
                                }
                            </div>
                            @*<div class="col s8 right-align">
                                <input type="submit" value="Calificar" class="btn-small  " />
                                </div>*@
                        </div>
                    </div>
                </div>
            </div>
        </div>
                                                                }
                                                                if (ViewBag.workflow.Count != 0)
                                                                {
        <div class="row" style="font-size:12px;">
            <div class="col s12">
                <div class="card-panel">
                    <div class="row" style="margin-bottom:0">
                        <h5>Workflow</h5>
                        <table class="table highlight responsive-table" id="table">
                            <thead>
                                <tr>
                                    <th width="" id="lbl_us">
                                        Usuario
                                    </th>
                                    <th width="" id="lbl_ev">
                                        Evento
                                    </th>
                                    <th width="" id="lbl_fi"> Fecha inicio</th>
                                    <th width="" id="lbl_hi"> Hora inicio</th>
                                    <th width="" id="lbl_ft"> Fecha término</th>
                                    <th width="" id="lbl_ht"> Hora término</th>
                                    @* -------DRS 24.09.18------- *@
                                    <th width="" id="lbl_ew">
                                        Estatus WF
                                    </th>
                                    <th width="" id="lbl_es">
                                        Estatus
                                    </th>
                                    <th width="30%" id="lbl_co">
                                        Comentario
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (TAT001.Entities.FLUJO f in ViewBag.workflow)
                                {
                                    <tr>
                                        <td width=""> @Html.DisplayFor(modelItem => f.USUARIOA_ID) - @Html.DisplayFor(modelItem => f.USUARIO.NOMBRE) @Html.DisplayFor(modelItem => f.USUARIO.APELLIDO_P) @Html.DisplayFor(modelItem => f.USUARIO.APELLIDO_M) </td>
                                        <td width=""> @Html.DisplayFor(modelItem => f.WORKFP.ACCION.DESCCRIPCION) </td>
                                        <td width=""> @f.FECHAC.Value.ToShortDateString() </td>
                                        <td width=""> @f.FECHAC.Value.TimeOfDay.ToString().Split('.')[0] </td>
                                        <td width=""> @f.FECHAM.Value.ToShortDateString() </td>
                                        <td width=""> @f.FECHAM.Value.TimeOfDay.ToString().Split('.')[0] </td>
                                        <td width=""> @Html.DisplayFor(modelItem => f.ESTATUS) </td>
                                        @* ------DRS 24.09.18------ *@
                                        <td width="">
                                            @{
                                                string est = (Html.DisplayFor(modelItem => f.STATUS)).ToString();

                                                TAT001.Services.Estatus c = new TAT001.Services.Estatus();
                                                c.getText(est, Model.D.NUM_DOC);
                                            }
                                            @c.getText(est, Model.D.NUM_DOC)

                                        </td>
                                        <td width="30%"> @Html.DisplayFor(modelItem => f.COMENTARIO) </td>
                                    </tr>
                                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    }
}
catch (Exception ee)
{
    TAT001.Common.Log.ErrorLogApp(ee,"View-Details","");
    Session["error"] = ee.Message.ToString();
    <script>
        document.location.replace(root + "Home/Index");
    </script>
}
<p>
    @Html.ActionLink("Regresar", "Index")
</p>

@*///////////////////////////////L.G.P.P MODIFICACIONES INICIO*@
<script>
    var canal = $('#vtweg').val();
    var canal = canal.split('-');
    canal[0] = $.trim(canal[0]);
    $('#p_vtweg').text(canal[0]);
    //Obtener cliente id
    var kunnr = $('#payer_id').val();
    //$('#cli_name').val();
    $('#p_kunnr').text(kunnr);
    var aaa = document.getElementById("payer_id").value;
    asignarPresupuesto(aaa);

    function asignarPresupuesto(kunnr) {

        $.ajax({
            type: "POST",
            url: root + 'Listas/getPresupuesto',
            dataType: "json",
            data: { "kunnr": kunnr },

            success: function (data) {

                if (data !== null || data !== "") {
                    //$('#p_canal').text(data.P_CANAL);
                    //$('#p_banner').text(data.P_BANNER);
                    //$('#pc_c').text(data.PC_C);
                    //$('#pc_a').text(data.PC_A);
                    //$('#pc_p').text(data.PC_P);
                    //$('#pc_t').text(data.PC_T);
                    //RSG 26.04.2018----------------

                    //$('#p_canal').text('$' + ((data.P_CANAL / 1).toFixed(2)));
                    //$('#p_banner').text('$' + ((data.P_BANNER / 1).toFixed(2)));
                    //$('#pc_c').text('($' + ((data.PC_C / 1).toFixed(2)) + ')');
                    //$('#pc_a').text('($' + ((data.PC_A / 1).toFixed(2)) + ')');
                    //$('#pc_p').text('($' + ((data.PC_P / 1).toFixed(2)) + ')');
                    //$('#pc_t').text('($' + ((data.PC_T / 1).toFixed(2)) + ')');
                    //$('#consu').text('$' + ((data.CONSU / 1).toFixed(2)));
                    //RSG 26.04.2018----------------

                    $('#p_vtweg').text(canal[0] + ' ' + data.CANAL);
                    $('#p_kunnr').text(kunnr.replace(/^0+/, '') + ' ' + data.CLIENTE);
                    $('#p_canal').text(toShowG(data.P_CANAL));
                    $('#p_banner').text(toShowG(data.P_BANNER));
                    $('#pc_c').text(toShowG(data.PC_C * -1));
                    $('#pc_a').text(toShowG(data.PC_A * -1));
                    $('#pc_p').text(toShowG(data.PC_P * -1));
                    $('#pc_t').text(toShowG(data.PC_T * -1));
                    $('#consu').text(toShowG(data.CONSU));
                    //LGPP 21.08.2018----------------
                }

            },
            error: function (xhr, httpStatusMessage, customErrorMessage) {
                M.toast({ html: httpStatusMessage });
            },
            async: false
        });

    }

    formaClearing();
    //M.textareaAutoResize($('#txt_notas'));
</script>
@*///////////////////////////////L.G.P.P MODIFICACIONES FIN*@
@if (TempData["error"] != null)
{
    @*<div class="row red-text">
            @ViewBag.Error
        </div>*@

    if (TempData["error"].ToString() != "")
    {
        <script>
    /**/
    /**/
    /**/
    /**/
    M.toast({ html: '@TempData["error"]', classes: '' });
    /**/
    /**/
    /**/
    /**/
        </script>
    }
}
@* LEJ 09.07.18 *@
<script src="~/Scripts/ValidarFormatosDec.js"></script>
<script>
    $(document).ready(function () {
        $('.collapsible').collapsible();


        //OCG 11/10/18
        var cliente = $("#payer_id").val();
        var cli = cliente.split("");
        var con = 0;
        for (var i = 0; i < 10; i++) {
            if (cli[i] == 0) {
                con++;
            }
            else {
                i = 10;
            }
        }
        var clien = cliente.substring(con, 10);
        $("#payer_id").attr("value", clien);

    });

    function ligada() {
        /**/
        /**/
        var a = '@Model.D.LIGADA';
        /**/
        /**/

        return (a == "True");
    }
</script>

