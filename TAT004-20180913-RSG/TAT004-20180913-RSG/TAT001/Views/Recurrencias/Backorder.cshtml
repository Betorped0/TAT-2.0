@model TAT001.Models.DocumentoFlujo
@using TAT001.Entities
@{
    /**/

    //ViewBag.Title = "Páginas";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.pagina_r = 201;
    ViewBag.carpeta_r = 200;
}

@try
{
    <script src="~/Scripts/formatos.js"></script>
    <input id="miles" name="miles" type="hidden" value="@ViewBag.miles">//LEJ 09.07.18
    <input id="dec" name="dec" type="hidden" value="@ViewBag.dec">//LEJ 09.07.18
    <div class="row" style="margin-bottom:0">
        <div class="col s12 m5 l5">
            <div class="row" style="margin-bottom:0">
                <div class="input-field col s4">
                    @Html.EditorFor(model => model.D.USUARIOC_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIOC_ID, new { @id = "lbl_userid" })
                </div>
                <div class="input-field col s4">
                    @*<input type="text" id="txt_user" value="@ViewBag.usuario.MANAGER" disabled="disabled" />
                        <label for="txt_user">Manager</label>*@
                    @Html.EditorFor(model => model.D.USUARIO.MANAGER, new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIO.MANAGER, new { @id = "lbl_manager" })
                </div>
                <div class="input-field col s4">
                    @Html.EditorFor(model => model.D.USUARIO.BACKUP_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIO.BACKUP_ID, new { @id = "lbl_backup" })
                    @*<input type="text" id="txt_user" value="@ViewBag.usuario.BACKUP_ID" disabled="disabled" />
                        <label for="txt_user">Backup</label>*@
                </div>
            </div>
        </div>
        <div class="col s12 m2 l2">
            <div class="input-field col s6">
                @*<input type="text" id="txt_user" value="PRGA" disabled="disabled" />
                    <label for="txt_user">BU</label>*@
                @Html.EditorFor(model => model.D.USUARIO.BUNIT, new { htmlAttributes = new { @disabled = "disabled" } })
                @Html.LabelFor(model => model.D.USUARIO.BUNIT, "Sociedad", new { @id = "lbl_bu" })
            </div>
            <div class="input-field col s6">
                @if (Model.D.ESTATUS == "N")
                {
                    <input type="text" id="txt_status" value="Nuevo" disabled="disabled" />
                    <label for="txt_status" id="lbl_status">Estatus</label>
                }
            </div>
        </div>

    </div>

    <div class="">
        <div class="row">
            <div class="col s12">
                <ul class="tabs" id="tab">
                    <li class="tab col s2"><a href="#info" id="lbl_info">Información</a></li>
                    <li class="tab col s2"><a href="#supp" id="lbl_supp">Soporte</a></li>
                    <li class="tab col s2"><a href="#dist" id="lbl_dist" class="active">Distribución</a></li>
                    <li class="tab col s2"><a href="#fina" id="lbl_fina">Financiera</a></li>
                </ul>
            </div>
            <div id="info" class="col s12" style="font-size:12px;">
                <div class="row">
                    <div class="col s12 m6 l6">
                        @if (Model.D.DOCUMENTO_REF != null)
                        {
                            <div class="card-panel">
                                <div class="row" style="margin-bottom:0">
                                    <div class="input-field col s8">
                                        <input type="text" value="@Model.D.DOCUMENTO_REF" disabled="disabled" />
                                        @Html.LabelFor(model => model.D.DOCUMENTO_REF, "Provisión")
                                    </div>
                                    <div class="col s4 right-align">
                                        <a href="@Url.Action("Details", new { id=Model.D.DOCUMENTO_REF })" class="btn-small  ">Ver</a>
                                    </div>
                                </div>
                            </div>
                        }
                        <div class="card-panel">
                            <div class="row" style="margin-bottom:0">
                                <div class="input-field col s12">
                                    @Html.EditorFor(model => model.D.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(model.D.USUARIO.SPRAS_ID)).FirstOrDefault().TXT50, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.TSOL, "Tipo de solicitud", new { @id = "lbl_tsol" })
                                </div>
                                <div class="input-field col s12">
                                    @Html.EditorFor(model => model.D.GALL.GALLTs.Where(a => a.SPRAS_ID.Equals(model.D.USUARIO.SPRAS_ID)).FirstOrDefault().TXT50, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.GALL_ID, "Clasificación", new { @id = "lbl_gall" })
                                </div>
                                @Html.HiddenFor(model => model.D.GALL_ID, new { @id = "gall_id" })
                                @Html.HiddenFor(model => model.D.TALL_ID, new { @id = "tall_id" })
                                @Html.HiddenFor(model => model.D.MONTO_DOC_MD, new { @id = "monto_dis" })
                            </div>
                        </div>
                        <div class="card-panel">
                            <h5>Datos país</h5>
                            <div class="row" style="margin-bottom:0">
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.SOCIEDAD_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.SOCIEDAD, "Sociedad", new { @id = "lbl_bukrs" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.PAIS_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.PAIS_ID, "País", new { @id = "lbl_land" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.ESTADO, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.ESTADO, "Estado", new { @id = "lbl_state" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.CIUDAD, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.CIUDAD, "Ciudad", new { @id = "lbl_city" })
                                </div>
                            </div>
                        </div>
                        @*<div class="row" style="margin-bottom:0">
                        *@
                        <div class="card-panel">
                            <div class="row" style="margin-bottom:0">
                                <h5>Información general</h5>
                                <div class="input-field col s12">
                                    @Html.EditorFor(model => model.D.FECHAC, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                    @Html.LabelFor(model => model.D.FECHAC, "Fecha", new { @id = "lbl_fechac" })
                                </div>
                                <div class="input-field col s6 l6">
                                    @Html.EditorFor(model => model.D.PERIODO, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                    @Html.LabelFor(model => model.D.PERIODO, "Periodo", new { @id = "lbl_periodo" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.EJERCICIO, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                    @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio", new { @id = "lbl_ejer" })
                                </div>
                                <div class="input-field col s12">
                                    @Html.EditorFor(model => model.D.CONCEPTO, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.CONCEPTO, "Concepto", new { @id = "lbl_conce" })
                                </div>
                            </div>
                        </div>
                        @*
                            </div>*@
                        @if (Model.D.DOCUMENTOF != null)
                        {
                            if (Model.D.DOCUMENTOF.Count > 0)
                            {
                                <div class="card-panel">
                                    <h5>Facturas</h5>
                                    <div class="row" style="margin-bottom:0">
                                        <div class="col s12">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        @if (Model.D.DOCUMENTOF[0].FACTURA != "0")
                                                        {
                                                            <th>Factura</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].FECHA != null)
                                                        {
                                                            <th>Fecha</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].PROVEEDOR != "0         ")
                                                        {
                                                            <th>Proveedor</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].CONTROL != "0")
                                                        {
                                                            <th>Control</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].AUTORIZACION != "0")
                                                        {
                                                            <th>Autorización</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].VENCIMIENTO != null)
                                                        {
                                                            <th>Vencimiento</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].FACTURAK != "0")
                                                        {
                                                            <th>Factura k</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].EJERCICIOK != "0")
                                                        {
                                                            <th>Ejercicio</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].BILL_DOC != null)
                                                        {
                                                            if (Model.D.DOCUMENTOF[0].BILL_DOC.Trim() != "0")
                                                            {
                                                                <th>No fact</th>
                                                            }
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].BELNR.Trim() != "0")
                                                        {
                                                            <th>No documento</th>
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].PAYER != null)
                                                        {
                                                            if (Model.D.DOCUMENTOF[0].PAYER.Trim() != "0")
                                                            {
                                                                <th>Payer</th>
                                                            }
                                                            if (Model.D.DOCUMENTOF[0].PAYER.Trim() != "0")
                                                            {
                                                                <th>Nombre</th>
                                                            }
                                                        }
                                                        @if (Model.D.DOCUMENTOF[0].IMPORTE_FAC != null | Model.D.DOCUMENTOF[0].IMPORTE_FAC.ToString() != "0.00000")
                                                        {
                                                            <th>Importe Fac</th>
                                                        }
                                                    </tr>
                                                </thead>

                                                @using (TAT001Entities db = new TAT001Entities())
                                                {
                                                    foreach (var item in Model.D.DOCUMENTOF)
                                                    {
                                                        <tr>
                                                            @if (item.FACTURA != "0")
                                                            {
                                                                <td>@item.FACTURA</td>
                                                            }
                                                            @if (item.FECHA != null)
                                                            {
                                                                string fech = item.FECHA.ToString();
                                                                fech = fech.Substring(0, 10);
                                                                <td>@fech</td>
                                                            }
                                                            @if (item.PROVEEDOR.Trim() != "0")
                                                            {
                                                                <td>@item.PROVEEDOR</td>
                                                            }
                                                            @if (item.CONTROL != "0")
                                                            {
                                                                <td>@item.CONTROL</td>
                                                            }
                                                            @if (item.AUTORIZACION != "0")
                                                            {
                                                                <td>@item.AUTORIZACION</td>
                                                            }
                                                            @if (item.VENCIMIENTO != null)
                                                            {
                                                                string venc = item.VENCIMIENTO.ToString();
                                                                venc = venc.Substring(0, 10);
                                                                <td>@venc</td>
                                                            }
                                                            @if (item.FACTURAK != "0")
                                                            {
                                                                <td>@item.FACTURAK</td>
                                                            }
                                                            @if (item.EJERCICIOK != "0")
                                                            {
                                                                <td>@item.EJERCICIOK</td>
                                                            }
                                                            @if (item.BILL_DOC != null)
                                                            {
                                                                if (item.BILL_DOC.Trim() != "0")
                                                                {
                                                                    <td>@item.BILL_DOC</td>
                                                                }
                                                            }
                                                            @if (item.BELNR.Trim() != "0")
                                                            {
                                                                <td>@item.BELNR</td>
                                                            }
                                                            @if (item.PAYER != null)
                                                            {
                                                                if (item.PAYER.Trim() != "0")
                                                                {
                                                                    <td>@item.PAYER</td>
                                                                }
                                                                if (item.PAYER.Trim() != "0")
                                                                {
                                                                    <td>@db.CLIENTEs.Where(x => x.KUNNR == item.PAYER.Trim()).Select(x => x.NAME1).FirstOrDefault()</td>
                                                                }
                                                            }
                                                            @if (Model.D.DOCUMENTOF[0].IMPORTE_FAC != null | Model.D.DOCUMENTOF[0].IMPORTE_FAC.ToString() != "0.00000")
                                                            {
                                                                decimal asd = Convert.ToDecimal(item.IMPORTE_FAC);
                                                                string impFac = asd.ToString("N2");
                                                                //double impFac2 = Convert.ToDouble(impFac);
                                                                <td>$@impFac</td>
                                                            }
                                                        </tr>
                                                    }
                                                }
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                    <div class="col s12 m6 l6">
                        <div class="row" style="margin-bottom:0">
                            <div class="card-panel">
                                <h5>@*@Html.DisplayFor(model => model.D.CLIENTE.KUNNR)*@</h5>
                                <div class="row" style="margin-bottom:0">
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.CLIENTE.KUNNR, new { htmlAttributes = new { @disabled = "disabled", @id = "payer_id" } })
                                        @Html.LabelFor(model => model.D.CLIENTE.KUNNR)
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.CLIENTE.NAME1, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.CLIENTE.NAME1, "Nombre", new { @id = "lbl_name" })
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.CLIENTE.STCD1, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.CLIENTE.STCD1, "Taxid", new { @id = "lbl_stcd1" })
                                    </div>
                                    <div class="input-field col s12">
                                        @Html.EditorFor(model => model.D.CLIENTE.CANAL, new { htmlAttributes = new { @disabled = "disabled", @id = "vtweg" } })
                                        @Html.LabelFor(model => model.D.CLIENTE.CANAL, "Canal", new { @id = "lbl_stcd1" })
                                    </div>
                                </div>
                            </div>
                            <div class="card-panel">
                                <div class="row" style="margin-bottom:0">
                                    <h5>Vigencia</h5>
                                    <div class="input-field col s12">
                                        @*@Html.EditorFor(model => model.D.FECHAI_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text", @value=Model.D.FECHAI_VIG.Value.ToShortDateString() } })*@
                                        <input type="text" value="@Model.D.FECHAI_VIG.Value.ToShortDateString()" disabled="disabled" />
                                        @Html.LabelFor(model => model.D.FECHAI_VIG, "De", new { @id = "lbl_fechai" })
                                    </div>
                                    <div class="input-field col s12">
                                        @*@Html.EditorFor(model => model.D.FECHAF_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })*@
                                        <input type="text" value="@Model.D.FECHAF_VIG.Value.ToShortDateString()" disabled="disabled" />
                                        @Html.LabelFor(model => model.D.FECHAF_VIG, "A", new { @id = "lbl_fechaf" })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @*<div id="temp" class="col s12">
            *@
            @if (Model.D.DOCUMENTORECs.Count > 0)
            {
                <div id="recu" class="col s12">
                    <div class="row">
                        @*<div class="col s12 m12 l12">
                                <div class="card-panel">
                                    <div class="row" style="margin-bottom:0">
                                        <h5>Vigencia</h5>
                                        <div class="input-field col s6">
                                            @Html.EditorFor(model => model.D.FECHAI_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                            @Html.LabelFor(model => model.D.FECHAI_VIG, "De", new { @id = "lbl_fechai" })
                                        </div>
                                        <div class="input-field col s6">
                                            @Html.EditorFor(model => model.D.FECHAF_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                            @Html.LabelFor(model => model.D.FECHAF_VIG, "A", new { @id = "lbl_fechaf" })
                                        </div>
                                    </div>
                                </div>
                            </div>*@
                        @if (Model.D.DOCUMENTORECs.Count() > 0)
                        {
                            <div class="col s12 m12 l12" style="font-size:12px;">
                                <div class="card-panel">
                                    <div class="row">
                                        <h5>Recurrencia</h5>
                                    </div>
                                    <div class="row">
                                        <div class="col s12">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Pos</th>
                                                        <th>Tipo</th>
                                                        <th>Documento</th>
                                                        <th>Fecha</th>
                                                        <th>Monto</th>
                                                        <th>%</th>
                                                        <th>Aplicado</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var iteem in Model.D.DOCUMENTORECs)
                                                    {
                                                        <tr>
                                                            <td>@iteem.POS</td>
                                                            <td>@Model.D.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(Session["spras"].ToString())).FirstOrDefault().TXT50</td>
                                                            @if (iteem.DOC_REF > 0)
                                                            {
                                                                <td><a href="@Url.Action("Details", new { id=iteem.DOC_REF })">@iteem.DOC_REF</a></td>
                                                            }
                                                            else
                                                            {
                                                                <td></td>
                                                            }
                                                            <td>@iteem.FECHAV.Value.ToShortDateString()</td>
                                                            <td class="precio">@iteem.MONTO_BASE</td>
                                                            <td class="porcentaje">@Math.Round(iteem.PORC.Value, 2)</td>
                                                            @if (iteem.ESTATUS == "P")
                                                            {
                                                                <td><i class="material-icons">check</i></td>
                                                            }
                                                            else
                                                            {
                                                                <td><i class="material-icons">close</i></td>
                                                            }
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
            <div id="supp" class="col s12">
                @{
                    List<TAT001.Entities.DOCUMENTOA>
                        archivos = ViewBag.files as List<TAT001.Entities.DOCUMENTOA>
                            ;
                    string[] nombrefile;
                }
                <div class="row">
                    <div class="col s12 m12 l6">
                        <div class="card-panel">
                            <div class="row">
                                <h5>Soportes</h5>
                            </div>
                            <div class="row">
                                @using (Html.BeginForm("Descargar", "Solicitudes", FormMethod.Post))
                                {
                                    try
                                    {
                                        for (int i = 0; i < archivos.Count; i++)
                                        {
                                            nombrefile = archivos[i].PATH.Split('\\');
                                            <div class="file-field input-field">
                                                <button id="lbl_cargar" name="archivo" class="btn" type="submit" value="@archivos[i].PATH">DESCARGAR</button>
                                                <div class="file-path-wrapper">
                                                    <input disabled value="@nombrefile[nombrefile.Length - 1]" id="disabled" type="text" class="file-path validate">
                                                </div>
                                            </div>
                                        }
                                    }
                                    catch (Exception)
                                    {
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="dist" class="col s12">
                <div class="row">
                    @if (Model.D.LIGADA != null)
                    {
                        if ((bool)Model.D.LIGADA & Model.D.DOCUMENTORECs.Count == 0)
                        {
                            <div class="col l6 offset-l6 m6 l6">
                                <div class="card-panel">
                                    <h5>Base para aplicar</h5>
                                    <div class="row" style="margin-bottom:0px;">
                                        <div class="input-field col s6">
                                            <input type="text" value="@Model.D.PORC_APOYO" class="porcentaje" disabled="disabled" id="PORC_APOYO" />
                                            <label for="txt_porc">Porcentaje apoyo</label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">
                                            @*<input type="text" value="0.00" class="precio" disabled="disabled" id="txt_venta" onload="calcValor()" />*@
                                            <input type="text" value="@Model.D.DOCUMENTOLs.FirstOrDefault().MONTO_VENTA" class="precio" disabled="disabled" id="txt_venta" />
                                            <label for="txt_porc">Venta del mes</label>
                                        </div>
                                        <div class="input-field col s6">
                                            <input type="text" value="@Model.D.MONTO_DOC_MD" class="precio" disabled="disabled" id="MONTO_DOC_MD" />
                                            <label for="txt_porc">Monto base</label>
                                        </div>
                                        <form method="post">
                                            @Html.HiddenFor(model => model.D.NUM_DOC)
                                            @Html.HiddenFor(model => model.D.LIGADA)
                                            <div class="input-field col s6">
                                                <input type="text" value="@Model.D.DOCUMENTOLs.FirstOrDefault().BACKORDER" class="precio" id="BACKORDER" name="BACKORDER" onchange="this.value = toShow(this.value);" onfocus="this.select();" />
                                                <label for="BACKORDER">BackOrder</label>
                                            </div>
                                            <div class="col s12 m12 right-align">
                                                <input type="submit" value="Recalcular" class="btn-small" />
                                            </div>
                                        </form>
                                        <script>
                                            //function calcValor() {
                                            ////var venta = ((document.getElementById("MONTO_DOC_MD").value) / (document.getElementById("PORC_APOYO").value)) * 100;
                                            ////document.getElementById("txt_venta").value = venta;
                                            //}
                                        </script>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    <div class="col s12">
                        <div class="card-panel">
                            <div class="row" style="margin-bottom:0">
                                <h5>Distribución</h5>
                                <div class="input-field col s12" style="overflow:auto;">
                                    @if (Model.D.DOCUMENTOPs.Count > 0)
                                    {
                                        <table style="font-size: 12px;" id="ctlDis" class="table">
                                            <thead>
                                                <tr>
                                                    <th>Vigencia de</th>
                                                    <th>Vigencia a</th>
                                                    @if (Model.D.DOCUMENTOPs.First().MATNR != "")
                                                    {
                                                        <th>Material</th>
                                                    }
                                                    else
                                                    {
                                                        <th>Categoría</th>
                                                    }
                                                    <th>Descripción</th>
                                                    <th>Precio unitario</th>
                                                    <th>% apoyo</th>
                                                    <th>Apoyo por pieza</th>
                                                    <th>Precio sugerido</th>
                                                    @if (Model.D.TSOL.FACTURA == false)
                                                    {
                                                        <th>Volumen estimado</th>
                                                        <th>Estimado apoyo</th>
                                                    }
                                                    else
                                                    {
                                                        <th>Volumen real</th>
                                                        <th>Apoyo real</th>
                                                    }
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in Model.D.DOCUMENTOPs.Where(a => a.VIGENCIA_DE != null & (a.MATNR != "" | a.MATKL != null)))
                                                {
                                                    <tr id="pos-@item.POS" onclick="muestra(this.id)">
                                                        <td>
                                                            @try
                                                            {@item.VIGENCIA_DE.Value.ToShortDateString()}
                                                        catch { }
                                                        </td>
                                                        <td>
                                                            @try
                                                            {@item.VIGENCIA_AL.Value.ToShortDateString()}
                                                        catch { }
                                                        </td>
                                                        @if (item.MATNR != "")
                                                        {
                                                            <td>@item.MATNR.TrimStart('0')</td>
                                                        }
                                                        else
                                                        {
                                                            <td>@item.MATKL</td>
                                                        }
                                                        @{
                                                            using (TAT001.Entities.TAT001Entities db = new TAT001.Entities.TAT001Entities())
                                                            {
                                                                if (item.MATNR != "")
                                                                {
                                                                    var matnr = db.MATERIALs.Find(item.MATNR);
                                                                    if (matnr != null)
                                                                    {
                                                                        <td>@matnr.MAKTX</td>}
                                                                    else
                                                                    {
                                                                        <td></td>
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    var matkl = db.MATERIALGPs.Find(item.MATKL);
                                                                    if (matkl != null)
                                                                    {
                                                                        <td>@matkl.MATERIALGPTs.Where(a => a.SPRAS_ID.Equals(Session["spras"].ToString())).FirstOrDefault().TXT50 </td>}
                                                                    else
                                                                    {
                                                                        <td></td>
                                                                    }
                                                                }

                                                            }
                                                        }

                                                        @*LEJ 12.07.18 Añadi un identificador para modificarse dinamicamente*@
                                                        <td class="precio">@Math.Round(item.MONTO, 2)</td>
                                                        <td class="porcentaje">@Math.Round(item.PORC_APOYO, 2)</td>
                                                        <td class="precio">@Math.Round(item.MONTO_APOYO, 2)</td>
                                                        <td class="precio">@Math.Round(item.PRECIO_SUG, 2)</td>
                                                        @if (Model.D.TSOL.FACTURA == false)
                                                        {
                                                            <td class="numero">@Math.Round(item.VOLUMEN_EST, 2)</td>
                                                            <td class="precio">@Math.Round((decimal)item.APOYO_EST, 2)</td>
                                                        }
                                                        else
                                                        {
                                                            <td class="numero">@Math.Round((decimal)item.VOLUMEN_REAL, 2)</td>
                                                            <td class="precio">@Math.Round(((decimal)item.APOYO_REAL), 2)</td>
                                                        }
                                                    </tr>
                                                    @*LEJ 12.07.18 Añadi un identificador para modificarse dinamicamente*@
                                                    foreach (var mat in item.DOCUMENTOMs)
                                                    {
                                                        <tr class="mat-@mat.POS_ID grey lighten-4" style="display:none;">
                                                            <td></td>
                                                            <td></td>
                                                            <td>@mat.MATNR.TrimStart('0')</td>
                                                            @{
                                                                using (TAT001.Entities.TAT001Entities db = new TAT001.Entities.TAT001Entities())
                                                                {
                                                                    if (mat.MATNR != "")
                                                                    {
                                                                        var matnr = db.MATERIALs.Find(mat.MATNR);
                                                                        if (matnr != null)
                                                                        {
                                                                            <td>@matnr.MAKTX</td>}
                                                                        else
                                                                        {
                                                                            <td></td>
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            @if (Model.D.TSOL.FACTURA == false)
                                                            {
                                                                <td class="precio">@Math.Round((decimal)mat.APOYO_EST, 2)</td>
                                                            }
                                                            else
                                                            {
                                                                <td class="precio">
                                                                    @Math.Round((decimal)mat.APOYO_REAL, 2)
                                                                </td>
                                                            }
                                                        </tr>

                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script src="~/Scripts/formatos.js"></script>
                <script>
                    function muestra(id) {
                        var ii = id.split('-')[1];
                        var clas = $("#" + id).hasClass("m");
                        if (!clas) {
                            var a = document.getElementsByClassName("mat-" + ii);
                            var i;
                            for (i = 0; i < a.length; i++) {
                                a[i].style.display = "table-row";
                            }
                            document.getElementById("pos-" + ii).classList.add("m");
                        }
                        else {
                            var a = document.getElementsByClassName("mat-" + ii);
                            var i;
                            for (i = 0; i < a.length; i++) {
                                a[i].style.display = "none";
                            }
                            document.getElementById("pos-" + ii).classList.remove("m");
                        }

                    }
                </script>
            </div>
            <div id="fina" class="col s12">
                <div class="row">
                    @if (ViewBag.acciones != null)
                    {
                        if (ViewBag.accion == "T")
                        {
                            <div class="col s12 m12 l12">
                                @using (Html.BeginForm("Taxeo", "Solicitudes"))
                                {
                                    @Html.AntiForgeryToken()
                                    @Html.HiddenFor(model => model.D.NUM_DOC)
                                    @Html.HiddenFor(model => model.D.LIGADA)
                                    <div class="card-panel">
                                        <h5>Taxeo</h5>
                                        <div class="row">
                                            <div class="col s12 m12 l12">
                                                <div class="row" id="lbl_taxeo">
                                                    <div class="input-field col s6 m6 l3">
                                                        <select id="txt_concepto" name="txt_concepto" onchange="selConcepto(this.value)">
                                                            <option value=""></option>
                                                        </select>
                                                        <label for="txt_concepto">Concepto</label>
                                                    </div>
                                                    <div class="input-field col s6 m6 l3">
                                                        <input id="txt_nota" name="txt_nota" disabled="disabled" />
                                                        <label id="lbl_nota" for="txt_nota">Tipo de nota</label>
                                                    </div>
                                                    <div class="col s12 m12 l6">
                                                        <div>
                                                            <table class="table" id="tab_conc">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Concepto</th>
                                                                        <th>Porcenaje</th>
                                                                        <th>Código</th>
                                                                        <th>Totales</th>
                                                                    </tr>
                                                                <thead>
                                                                <tbody></tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                <script>
                                                taxeo("txt_concepto");

                                                function taxeo(id) {
                                                    var campo = document.getElementById(id);
                                                    $("#" + id).find('option').remove();
                                                    //$("#lbl_puestos").empty();
                                                    ///1

                                                    /**/
                                                    var soci = '@Model.D.SOCIEDAD_ID';
                                                /**/
                                                /**/
                                                var pais = '@Model.D.PAIS_ID';
                                                /**/
                                                /**/
                                                var vkorg = '@Model.D.VKORG';
                                                /**/
                                                /**/
                                                var vtweg = '@Model.D.VTWEG';
                                                /**/
                                                /**/
                                                var spart = '@Model.D.SPART';
                                                /**/
                                                /**/
                                                var kunnr = '@Model.D.PAYER_ID';
                                                /**/
                                                /**/
                                                var spras = '@Session["spras"].ToString()';
                                                /**/
                                                $.ajax({
                                                    url: "../../Listas/selectTaxeo",
                                                    type: "GET",
                                                    async: false,
                                                    timeout: 30000,
                                                    dataType: "json",
                                                    data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, spras: spras },
                                                    success: function (data) {
                                                        var pp = ($.map(data, function (item) {
                                                            return { label: item.TXT50, value: item.CONCEPTO_ID };
                                                        }))
                                                        $("#" + id)
                                                            .append($("<option></option>")
                                                                .attr("value", "")
                                                                .text(""));
                                                        for (var i = 0; i < pp.length; i++) {
                                                            //var div =  "<option value='" + pp[i].value + "'>" + pp[i].label + "</option>"
                                                            //$("#txt_pai").append(div);
                                                            $("#" + id)
                                                                .append($("<option></option>")
                                                                    .attr("value", pp[i].value)
                                                                    .text(pp[i].label));
                                                        }
                                                        var el = document.getElementById(id);
                                                        var instances = M.FormSelect.init(el, []);
                                                    }
                                                });
                                            }

                                            function selConcepto(value) {
                                                //2
                                                //$("#lbl_puestos").empty();
                                                /**/
                                                var soci = '@Model.D.SOCIEDAD_ID';
                                                /**/
                                                /**/
                                                var pais = '@Model.D.PAIS_ID';
                                                /**/
                                                /**/
                                                var vkorg = '@Model.D.VKORG';
                                                /**/
                                                /**/
                                                var vtweg = '@Model.D.VTWEG';
                                                /**/
                                                /**/
                                                var spart = '@Model.D.SPART';
                                                /**/
                                                /**/
                                                var kunnr = '@Model.D.PAYER_ID';
                                                /**/
                                                var concepto_id = value;
                                                /**/
                                                var spras = '@Session["spras"].ToString()';
                                                /**/
                                                $.ajax({
                                                    url: "../../Listas/selectConcepto",
                                                    type: "POST",
                                                    async: false,
                                                    timeout: 30000,
                                                    dataType: "json",
                                                    data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, concepto: concepto_id, spras: spras },
                                                    success: function (data) {
                                                        var pp = ($.map(data, function (item) {
                                                            return { label: item.TXT50, value: item.CONCEPTO_ID };
                                                        }))
                                                        if (pp.length > 0) {
                                                            $("#txt_nota").val(pp[0].label);
                                                            $("#lbl_nota").addClass("active");
                                                        }
                                                        else {
                                                            $("#txt_nota").val("");
                                                            $("#lbl_nota").removeClass("active");
                                                        }
                                                    }
                                                });
                                                $.ajax({
                                                    url: "../../Listas/selectImpuesto",
                                                    type: "POST",
                                                    async: false,
                                                    timeout: 30000,
                                                    dataType: "json",
                                                    data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, concepto: concepto_id, spras: spras },
                                                    success: function (data) {
                                                        $("#tab_conc tbody").empty();
                                                        var pp = ($.map(data, function (item) {
                                                            return { IMPUESTO_ID: item.IMPUESTO_ID, PORC: item.PORC, TEXT: item.TXT50 };
                                                        }))
                                                        for (var i = 0; i < pp.length; i++) {
                                                            var cod = pp[i].IMPUESTO_ID;
                                                            var por = pp[i].PORC;
                                                            /**/
                                                            var tot = @Model.D.MONTO_DOC_ML;
                                                /**/
                                                var sub = tot * por / 100;

                                                $("#tab_conc tbody").append("<tr><td>" + pp[i].TEXT + "</td><td>" + (por / 100) + "%</td><td>" + cod + "</td><td>" + sub + "</td><tr>");
                                            }
                                        }
                                    });
                                }
                                                </script>
                                            </div>
                                            <div class="col s12 right-align">
                                                <input type="submit" class="btn" value="Enviar" />
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                    }
                    <div class="col s12 m6 l6">
                        <div class="card-panel">
                            <h5>Detalle de solicitud</h5>
                            <div class="row" style="margin-bottom:0">
                                <div class="input-field col s8">
                                    @if (ViewBag.accion == "N")
                                    {
                                        @Html.EditorFor(model => model.D.MONTO_DOC_MD)
                                    }
                                    @Html.EditorFor(model => model.D.MONTO_DOC_MD, new { htmlAttributes = new { @disabled = "disabled", @class = "_vmonto" } })
                                    @Html.LabelFor(model => model.D.MONTO_DOC_MD, "Monto", new { @id = "lbl_montomd" })
                                </div>
                                <div class="input-field col s4">
                                    @Html.EditorFor(model => model.D.MONEDA_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                                    @Html.LabelFor(model => model.D.MONEDA_ID, "Moneda", new { @id = "lbl_waers" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.TIPO_CAMBIO, new { htmlAttributes = new { @disabled = "disabled", @class = "_tc" } })
                                    @Html.LabelFor(model => model.D.TIPO_CAMBIO, "Tipo de cambio", new { @id = "lbl_tcambio" })
                                </div>
                                <div class="input-field col s6">
                                    @Html.EditorFor(model => model.D.MONTO_DOC_ML2, new { htmlAttributes = new { @disabled = "disabled", @class = "_vmonto2" } })
                                    @Html.LabelFor(model => model.D.MONTO_DOC_ML2, "Monto USD", new { @id = "lbl_montoml2" })
                                </div>
                                @if (Model.D.TSOL_ID == "PR")
                                {
                                    <div class="input-field col s4">
                                        @Html.EditorFor(model => model.D.TSOL_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.TSOL_ID, "Company code", new { @id = "lbl_montoml2" })
                                    </div>
                                    <div class="input-field col s4">
                                        @Html.EditorFor(model => model.D.DOCUMENTO_SAP, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.DOCUMENTO_SAP, "No. Docuemento SAP", new { @id = "lbl_montoml2" })
                                    </div>
                                    <div class="input-field col s4">
                                        @Html.EditorFor(model => model.D.SOCIEDAD_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.SOCIEDAD_ID, "Company code", new { @id = "lbl_montoml2" })
                                    </div>
                                    <div class="input-field col s6">
                                        @Html.EditorFor(model => model.D.PERIODO, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.PERIODO, "Periodo", new { @id = "lbl_montoml2" })
                                    </div>
                                    <div class="input-field col s6">
                                        @Html.EditorFor(model => model.D.EJERCICIO, new { htmlAttributes = new { @disabled = "disabled" } })
                                        @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio", new { @id = "lbl_montoml2" })
                                    </div>
                                }
                                <div class="input-field col s12">
                                    @Html.TextAreaFor(model => model.D.NOTAS, new { @id = "txt_notas", @class = "materialize-textarea", @style = "height:500px;", @disabled = "disabled" })
                                    @Html.LabelFor(model => model.D.NOTAS, "Mecánica de negociación", new { @id = "lbl_notas" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m6 l6 right">
                        <!--RSG 22.05.2018-->
                        <div class="card-panel">
                            <div class="row">
                                <h5>Cuentas</h5>
                                <div class="col s12">
                                    <div id="div_clearing">
                                    </div>
                                </div>
                            </div>
                            <script>
                                        var clearing = [];
                                        function getClearing(gall) {
                                            $("#div_clearing").empty();
                                            clearing = [];
                                            /**/
                                            /**/
                                            var bukrs = '@Model.D.SOCIEDAD_ID';
                                        /**/
                                        /**/
                                        /**/
                                        /**/
                                        var land = '@Model.D.PAIS_ID';
                                        /**/
                                        /**/
                                        /**/
                                        /**/
                                        var ejercicio = '@Model.D.EJERCICIO';
                                        /**/
                                        /**/
                                        $.ajax({
                                            type: "POST",
                                            url: '../../Listas/clearing',
                                            dataType: "json",
                                            data: { bukrs: bukrs, land: land, gall: gall, ejercicio: ejercicio },

                                            success: function (data) {
                                                if (data !== null || data !== "") {
                                                    //RSG 26.04.2018----------------
                                                    clearing.push(data.ABONO);
                                                    clearing.push(data.CARGO);
                                                    clearing.push(data.CLEARING);
                                                    clearing.push(data.LIMITE);
                                                    //RSG 26.04.2018----------------
                                                }

                                            },
                                            error: function (xhr, httpStatusMessage, customErrorMessage) {
                                                M.toast({ html: httpStatusMessage });
                                            },
                                            async: false
                                        });

                                    }
                                    function formaClearing() {
                                        getClearing(document.getElementById("tall_id").value);
                                        $("#div_clearing").empty();
                                        var monto = document.getElementById("monto_dis").value;
                                        //LEJ 09.07.18---------------------------------------------
                                        var _monto = monto.split('.');
                                        var _miles = document.getElementById("miles").value;
                                        var _decimales = document.getElementById("dec").value;
                                        var _millesMonto = _monto[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g, _miles);
                                        var div = "<ul class='collection'><li class='collection-item'>";
                                        div += "<div class='row' style='margin-bottom:0;'><div class='col s4'>Abono</div><div class='col s4'>" + clearing[0] + "</div><div class='col s4 right-align'>$" + _millesMonto + _decimales + _monto[1] + "</div></div>";
                                        div += "</li><li class='collection-item'>";

                                        if (clearing[3] == null) {
                                            div += "<div class='row' style='margin-bottom:0;'><div class='col s4'>Cargo</div><div class='col s4'>" + clearing[1] + "</div><div class='col s4 right-align'>$" + _millesMonto + _decimales + _monto[1] + "</div></div>";
                                        }
                                        else {
                                            if (clearing[2] != null) {
                                                if (monto <= clearing[3]) {
                                                    div += "<div class='row' style='margin-bottom:0;'><div class='col s4'>Cargo</div><div class='col s4'>" + clearing[1] + "</div><div class='col s4 right-align'>$" + _millesMonto + _decimales + _monto[1] + "</div></div>";
                                                    div += "</li><li class='collection-item'>                                        ";
                                                    div += "<div class='row' style='margin-bottom:0;'><div class='col s4'>Clearing</div><div class='col s4'>" + clearing[2] + "</div><div class='col s4 right-align'>$0.00</div></div>";
                                                    div += "    </li>";
                                                }
                                                else {
                                                    div += "  <div class='row' style='margin-bottom:0;'><div class='col s4'>Cargo</div><div class='col s4'>" + clearing[1] + "</div><div class='col s4 right-align'>$" + clearing[3] + "</div></div>";
                                                    div += "</li><li class='collection-item'>                                     ";
                                                    div += "<div class='row' style='margin-bottom:0;'><div class='col s4'>Clearing</div><div class='col s4'>" + clearing[2] + "</div><div class='col s4 right-align'>$" + (monto - clearing[3]) + "</div></div>";
                                                    div += "          </li>";
                                                }
                                            }
                                        }
                                        div += "</li>";
                                        div += "       </ul>";
                                        $("#div_clearing").append(div);
                                    }
                            </script>
                        </div>
                        @using (TAT001Entities db = new TAT001Entities())
                        {
                            List<DOCUMENTO>
                                inf = new List<DOCUMENTO>
                                    ();
                            inf = db.DOCUMENTOes.Where(x => x.DOCUMENTO_REF == Model.D.NUM_DOC).ToList();
                            <div class="card-panel">
                                <div class="row">
                                    <h5>Relacionados</h5>
                                    <div class="col s12">
                                        @if (inf.Count() > 0)
                                        {
                                            <table class="table striped" id="table" style="width:100%; font-size:12px;">
                                                <thead>
                                                    <tr class="header">
                                                        <th>
                                                            @Html.LabelFor(model => model.D.TSOL_ID, "Tipo")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.NUM_DOC, "Documento")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.DOCUMENTO_SAP, "SAP")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.SOCIEDAD_ID, "Sociedad")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.PERIODO, "Periodo")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio")
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var miCi in inf)
                                                    {
                                                        <tr>
                                                            <td>
                                                                @miCi.TSOL_ID
                                                            </td>
                                                            <td>
                                                                <a href="@Url.Action("Details",new { id = miCi.NUM_DOC})">@miCi.NUM_DOC</a>
                                                            </td>
                                                            <td>
                                                                @miCi.DOCUMENTO_SAP
                                                            </td>
                                                            <td>
                                                                @miCi.SOCIEDAD_ID
                                                            </td>
                                                            <td>
                                                                @miCi.PERIODO
                                                            </td>
                                                            <td>
                                                                @miCi.EJERCICIO
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        }
                                        else
                                        {
                                            <table class="table striped" id="table" style="width:100%; font-size:12px;">
                                                <thead>
                                                    <tr class="header">
                                                        <th>
                                                            @Html.LabelFor(model => model.D.TSOL_ID, "Tipo")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.NUM_DOC, "Documento")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.DOCUMENTO_SAP, "SAP")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.SOCIEDAD_ID, "Sociedad")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.PERIODO, "Periodo")
                                                        </th>
                                                        <th>
                                                            @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio")
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            @Model.D.TSOL_ID
                                                        </td>
                                                        <td>
                                                            @Model.D.NUM_DOC
                                                        </td>
                                                        <td>
                                                            @Model.D.DOCUMENTO_SAP
                                                        </td>
                                                        <td>
                                                            @Model.D.SOCIEDAD_ID
                                                        </td>
                                                        <td>
                                                            @Model.D.PERIODO
                                                        </td>
                                                        <td>
                                                            @Model.D.EJERCICIO
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        }
                                    </div>
                                </div>
                            </div>
                        }

                        @*///////////////////////////////L.G.P.P MODIFICACIONES INICIO*@
                        <div class="card-panel">
                            <h5>Análisis Presupuesto<p style="font-size:15px">Última fecha de carga @ViewBag.ultMod</p></h5>
                            <div class="row" style="margin-bottom:0">
                                <ul class="collection">
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s3">
                                                Presupuesto canal
                                            </div>
                                            <div class="col s3">
                                                <label id="p_vtweg">
                                                    aaaa
                                                </label>
                                            </div>
                                            <div class="col s3 right-align">
                                                <label id="p_canal">
                                                    1111
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s3">
                                                Presupuesto cliente
                                            </div>
                                            <div class="col s3">
                                                <label id="p_kunnr">

                                                </label>
                                            </div>
                                            <div class="col s3 right-align">
                                                <label id="p_banner">
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="row">
                                <ul class="collection">
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s3">
                                                Registrado en SAP
                                            </div>
                                            <div class="col s3 offset-s6 right-align">
                                                <label id="pc_c">
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s3">
                                                Por registrar en SAP
                                            </div>
                                            <div class="col s3 offset-s6 right-align">
                                                <label id="pc_a">
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s3">
                                                En proceso TAT
                                            </div>
                                            <div class="col s3 offset-s6 right-align">
                                                <label id="pc_p">
                                                </label>
                                                <hr align="right" />
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s3">
                                                Consumido
                                            </div>
                                            <div class="col s3 offset-s3 right-align">
                                                <b>
                                                    <label id="pc_t">
                                                    </label>
                                                </b>
                                                <hr />
                                            </div>
                                        </div>
                                    </li>
                                    <li class="collection-item">
                                        <div class="row" style="margin-bottom:0;">
                                            <div class="col s3">
                                                Presupuesto disponible
                                            </div>
                                            <div class="col s3 offset-s3 right-align">
                                                <label id="consu">
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                @*</ul>*@
                            </div>
                        </div>
                        @*///////////////////////////////L.G.P.P MODIFICACIONES FIN*@
                    </div>
                    @if (Model.D.CONCEPTO_ID != null)
                    {<div class="col s12 m12 l12">
                            <div class="card-panel">
                                <h5>Taxeo</h5>
                                <div class="row">
                                    <div class="col s12 m12 l12">
                                        <div class="row" id="lbl_taxeo">
                                            <div class="input-field col s6 m6 l3">
                                                <input type="text" id="txt_concepto" name="txt_concepto" value="@Model.D.CONCEPTO_ID" disabled="disabled" />
                                                <label for="txt_concepto">Concepto</label>
                                            </div>
                                            <div class="input-field col s6 m6 l3">
                                                <input id="txt_nota" name="txt_nota" disabled="disabled" />
                                                <label id="lbl_nota" for="txt_nota">Tipo de nota</label>
                                            </div>
                                            <div class="col s12 m12 l6">
                                                <div>
                                                    <table class="table" id="tab_conc">
                                                        <thead>
                                                            <tr>
                                                                <th>Concepto</th>
                                                                <th>Porcenaje</th>
                                                                <th>Código</th>
                                                                <th>Totales</th>
                                                            </tr>
                                                        <thead>
                                                        <tbody></tbody>
                                                        <tfoot>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <script>
                                                selConcepto(document.getElementById("txt_concepto").value);


                                                function selConcepto(value) {
                                                    //3
                                                    //$("#lbl_puestos").empty();
                                                    /**/
                                                    var soci = '@Model.D.SOCIEDAD_ID';
                                                /**/
                                                /**/
                                                var pais = '@Model.D.PAIS_ID';
                                                /**/
                                                /**/
                                                var vkorg = '@Model.D.VKORG';
                                                /**/
                                                /**/
                                                var vtweg = '@Model.D.VTWEG';
                                                /**/
                                                /**/
                                                var spart = '@Model.D.SPART';
                                                /**/
                                                /**/
                                                var kunnr = '@Model.D.PAYER_ID';
                                                /**/
                                                var concepto_id = value;
                                                /**/
                                                var spras = '@Session["spras"].ToString()';
                                                /**/
                                                $.ajax({
                                                    url: "../../Listas/selectConcepto",
                                                    type: "POST",
                                                    async: false,
                                                    timeout: 30000,
                                                    dataType: "json",
                                                    data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, concepto: concepto_id, spras: spras },
                                                    success: function (data) {
                                                        var pp = ($.map(data, function (item) {
                                                            return { label: item.TXT50, value: item.CONCEPTO_ID };
                                                        }))
                                                        if (pp.length > 0) {
                                                            $("#txt_nota").val(pp[0].label);
                                                            $("#lbl_nota").addClass("active");
                                                        }
                                                        else {
                                                            $("#txt_nota").val("");
                                                            $("#lbl_nota").removeClass("active");
                                                        }
                                                    }
                                                });
                                                $.ajax({
                                                    url: "../../Listas/selectImpuesto",
                                                    type: "POST",
                                                    async: false,
                                                    timeout: 30000,
                                                    dataType: "json",
                                                    data: { bukrs: soci, pais: pais, vkorg: vkorg, vtweg: vtweg, spart: spart, kunnr: kunnr, concepto: concepto_id, spras: spras },
                                                    success: function (data) {
                                                        $("#tab_conc tbody").empty();
                                                        var pp = ($.map(data, function (item) {
                                                            return { IMPUESTO_ID: item.IMPUESTO_ID, PORC: item.PORC, label: item.TXT50 };
                                                        }))
                                                        /**/
                                                        var foot = @Model.D.MONTO_DOC_ML;
                                                /**/
                                                for (var i = 0; i < pp.length; i++) {
                                                    var cod = pp[i].IMPUESTO_ID;
                                                    var por = pp[i].PORC;
                                                    /**/
                                                    var tot = @Model.D.MONTO_DOC_ML;
                                                /**/
                                                var sub = tot * por / 100;
                                                foot = foot + sub;

                                                $("#tab_conc tbody").append("<tr><td>" + pp[i].label + "</td><td>" + (por / 100) + "%</td><td>" + cod + "</td><td>" + sub + "</td><tr>");
                                            }

                                            $("#tab_conc tfoot").append("<tr><td></td><td></td><td></td><th>" + foot + "</th><tr>");
                                        }
                                    });
                                }
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>

                    }
                    @if (ViewBag.Relacionados != null)
                    {
                        if (ViewBag.Relacionados.Count > 0)
                        {

                            <div class="col s12 m6 l6">
                                <div class="card-panel">
                                    <h5>Relacionados</h5>
                                    <div class="row" style="margin-bottom:0">
                                        <div class="col s12">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Documento</th>
                                                        <th>Tipo Solicitud</th>
                                                        @*
                                                            <th>Fecha</th>
                                                            <th>Hora</th>*@
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (TAT001.Entities.DOCUMENTO item in ViewBag.Relacionados)
                                                    {
                                                        <tr>
                                                            <td>
                                                                @item.NUM_DOC
                                                            </td>
                                                            <td>
                                                                @item.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(Session["spras"].ToString())).FirstOrDefault().TXT50
                                                            </td>
                                                            @*
                                                                <td>
                                                                    @item.FECHAC.Value.ToShortDateString()
                                                                </td>
                                                                <td>
                                                                    @item.HORAC.Value.ToString().Split('.')[0]
                                                                </td>*@
                                                            <td>
                                                                <a href="@Url.Action("Details", new { id=item.NUM_DOC })" class="btn-small">Ver</a>
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>}
                    }
                </div>
            </div>
            @*<div id="dist" class="col s12">Test 4</div>*@
        </div>
        <script>
            var el = document.getElementById("tab");
            options = [];
            var instance = M.Tabs.init(el, options);
        </script>
    </div>
    if (ViewBag.tts.Count != 0)
    {

        <div class="row" style="font-size:12px;">
            <div class="col s12">
                <div class="row" style="margin-bottom:0">
                    <div class="card-panel">
                        <div class="row">
                            <h5>Trade Spending</h5>
                        </div>
                        <div class="row">
                            <div class="col l4 m4 s12">
                                @foreach (var item in ViewBag.tts)
                                {
                                    <div class="col s12">
                                        <p style="margin-top:0;">
                                            <label>
                                                @foreach (var ii in item.TS_CAMPO.TS_FORMT)
                                                {
                                                    if (ii.SPRAS_ID == Session["spras"].ToString())
                                                    {
                                                        if (item.CHECKS)
                                                        {
                                                            <input type="checkbox" id="chk-@item.TS_CAMPO.ID" name="chk-@item.TS_CAMPO.ID" checked="checked" disabled="disabled" />
                                                        }
                                                        else
                                                        {
                                                            <input type="checkbox" id="chk-@item.TS_CAMPO.ID" name="chk-@item.TS_CAMPO.ID" disabled="disabled" />
                                                        }
                                                        <span>@ii.TXT100</span>
                                                    }
                                                }
                                            </label>
                                        </p>
                                    </div>
                                }
                            </div>
                            @*<div class="col s8 right-align">
                                    <input type="submit" value="Calificar" class="btn-small  " />
                                </div>*@
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    if (ViewBag.workflow.Count != 0)
    {
        <div class="row" style="font-size:12px;">
            <div class="col s12">
                <div class="card-panel">
                    <div class="row" style="margin-bottom:0">
                        <h5>Workflow</h5>
                        @*
                            <script src="//code.jquery.com/jquery-1.12.4.js"></script>
                            <script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
                            <script src="//cdn.datatables.net/1.10.16/js/dataTables.material.min.js"></script>
                            <link href="~/Content/dataTable.css" rel="stylesheet" />
                            <link href="//cdn.datatables.net/1.10.16/css/dataTables.material.min.css" rel="stylesheet" />*@
                        <table class="table highlight responsive-table" id="table">
                            <thead>
                                <tr>
                                    <th width="">
                                        Usuario
                                    </th>
                                    <th width="">
                                        Evento
                                    </th>
                                    <th width=""> Fecha inicio</th>
                                    <th width=""> Hora inicio</th>
                                    <th width=""> Fecha término</th>
                                    <th width=""> Hora término</th>
                                    <th width="">
                                        Estatus
                                    </th>
                                    <th width="30%">
                                        Comentario
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (TAT001.Entities.FLUJO f in ViewBag.workflow)
                                {
                                    <tr>
                                        <td width=""> @Html.DisplayFor(modelItem => f.USUARIOA_ID) - @Html.DisplayFor(modelItem => f.USUARIO.NOMBRE) @Html.DisplayFor(modelItem => f.USUARIO.APELLIDO_P) @Html.DisplayFor(modelItem => f.USUARIO.APELLIDO_M) </td>
                                        <td width=""> @Html.DisplayFor(modelItem => f.WORKFP.ACCION.DESCCRIPCION) </td>
                                        <td width=""> @f.FECHAC.Value.ToShortDateString() </td>
                                        <td width=""> @f.FECHAC.Value.TimeOfDay.ToString().Split('.')[0] </td>
                                        <td width=""> @f.FECHAM.Value.ToShortDateString() </td>
                                        <td width=""> @f.FECHAM.Value.TimeOfDay.ToString().Split('.')[0] </td>
                                        <td width=""> @Html.DisplayFor(modelItem => f.ESTATUS) </td>
                                        <td width="30%"> @Html.DisplayFor(modelItem => f.COMENTARIO) </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    }
}
catch (Exception ee)
{
    Session["error"] = ee.Message.ToString();
    <script>
        document.location.replace("../../Home/Index");
    </script>
}
<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.D.NUM_DOC }) |
    @Html.ActionLink("Back to List", "Index")
</p>


@*///////////////////////////////L.G.P.P MODIFICACIONES INICIO*@
<script>
    var canal = $('#vtweg').val();
    var canal = canal.split('-');
    canal[0] = $.trim(canal[0]);
    $('#p_vtweg').text(canal[0]);
    //Obtener cliente id
    var kunnr = $('#payer_id').val();
    //$('#cli_name').val();
    $('#p_kunnr').text(kunnr);
    var aaa = document.getElementById("payer_id").value;
    asignarPresupuesto(aaa);

    function asignarPresupuesto(kunnr) {

        $.ajax({
            type: "POST",
            url: '../../Listas/getPresupuesto',
            dataType: "json",
            data: { "kunnr": kunnr },

            success: function (data) {

                if (data !== null || data !== "") {
                    //$('#p_canal').text(data.P_CANAL);
                    //$('#p_banner').text(data.P_BANNER);
                    //$('#pc_c').text(data.PC_C);
                    //$('#pc_a').text(data.PC_A);
                    //$('#pc_p').text(data.PC_P);
                    //$('#pc_t').text(data.PC_T);
                    //RSG 26.04.2018----------------
                    $('#p_canal').text('$' + ((data.P_CANAL / 1).toFixed(2)));
                    $('#p_banner').text('$' + ((data.P_BANNER / 1).toFixed(2)));
                    $('#pc_c').text('$' + ((data.PC_C / 1).toFixed(2)));
                    $('#pc_a').text('$' + ((data.PC_A / 1).toFixed(2)));
                    $('#pc_p').text('$' + ((data.PC_P / 1).toFixed(2)));
                    $('#pc_t').text('($' + ((data.PC_T / 1).toFixed(2)) + ')');
                    $('#consu').text('$' + ((data.CONSU / 1).toFixed(2)));
                    //RSG 26.04.2018----------------
                }

            },
            error: function (xhr, httpStatusMessage, customErrorMessage) {
                M.toast({ html: httpStatusMessage });
            },
            async: false
        });

    }

    formaClearing();
    //M.textareaAutoResize($('#txt_notas'));
</script>
@*///////////////////////////////L.G.P.P MODIFICACIONES FIN*@
@if (TempData["error"] != null)
{
    @*<div class="row red-text">
            @ViewBag.Error
        </div>*@

    if (TempData["error"].ToString() != "")
    {
        <script>
                /**/
                /**/
                M.toast({ html: '@TempData["error"]', classes: '' });
                /**/
                /**/
        </script>
    }
}
@* LEJ 09.07.18 *@
<script src="~/Scripts/ValidarFormatosDec.js"></script>
<script>
    $(document).ready(function () {
        $('.collapsible').collapsible();
                });

    function ligada() {
        var a = '@Model.D.LIGADA';

        return (a=="True");
    }
</script>
